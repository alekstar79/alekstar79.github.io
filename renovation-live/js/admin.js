(()=>{"use strict";const e={isTouch:()=>"ontouchstart"in window,int:e=>+/-?\d+/.exec(e),noComments:e=>e.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),up0:e=>e.replace(/^./,e[0].toUpperCase()),toCamel:t=>t.replace(/-[a-z]+/g,(t=>e.up0(t.slice(1)))),ofCamel:e=>e.replace(/[A-Z]/g,"-$&").toLowerCase(),styleToJS:t=>e.noComments(t).replace(/\s+/g,"").split(";").reduce(((t,i)=>{if(i){let n=i.split(":");t[e.toCamel(n[0])]=n[1]||""}return t}),{}),jsToStyle:t=>{let i="";for(let n in t)i+=`${e.ofCamel(n)}: ${t[n]}; `;return i}};class t{constructor(e,t){Object.defineProperty(this,"parent",{value:t}),Object.defineProperty(t,"_dataList",{value:{}});for(let t in e){const i=t,n=e[i];Object.defineProperty(this,i,{enumerable:!0,get(){return i in this.parent._dataList?this.parent._dataList[i]:n},set(e){this.group={[i]:e}}})}Object.defineProperty(this,"default",{enumerable:!0,get:()=>e})}set text(e){this.parent.attributeChangedCallback("param",this.text,e)}get text(){let t="";return Object.keys(this).filter((e=>!isNaN(+e))).forEach((i=>{t+=`${e.ofCamel(this[i])}: ${this.parent._dataList[this[i]]}; `})),t.slice(0,-1)}set group(t){this.parent.attributeChangedCallback("param",this.text,e.jsToStyle(Object.assign({},this.group,t)))}get group(){const e={};return Object.keys(this).filter((e=>!isNaN(+e))).forEach((t=>{Object.assign(e,{[this[t]]:this.parent._dataList[this[t]]})})),e}set(){this.parent.setAttribute("param",this.text)}changedCallback(t,i,n){let s={},l=this.default,a=t?e.styleToJS(t):{};for(let e in a)if(e in l){let t=a[e].replace(/\s+/g,""),i=this[e],n=l[e],s=typeof n;if("boolean"===s){let s=["","true","false"].indexOf(t);a[e]=s<0?i:[n,!0,!1][s]}else a[e]="number"===s?isNaN(+t)?i:+t:t||n}let o=Object.assign({},a),r={},d=Object.keys(this);for(let e in this)d.includes(e)||(r[e]=this[e]);if(i)for(let e in a)o[e]=e in l?i(e,o[e],this[e],l[e]):null,null===o[e]&&delete o[e];n&&n(o,Object.assign({},r));let c=this.parent._dataList;Object.keys(this).filter((e=>!isNaN(+e))).forEach((e=>{delete c[this[e]],delete this[e]}));let h=0;for(let e in o)null!==o[e]&&(Object.defineProperty(this,`${h}`,{value:e,enumerable:!0,configurable:!0}),h++,Object.defineProperty(c,`${e}`,{value:o[e],configurable:!0}));for(let e in r){let t=this[e],i=r[e],n=e in a?a[e]:i;n===i&&n===t||(s[e]={ask:n,old:i,new:t})}return s}}class i extends t{constructor(e){super({xSide:"s",xDepend:"inverse",xHide:!1,xQty:0,x:0,xStep:1,ySide:"e",yDepend:"inverse",yHide:!1,yQty:0,y:0,yStep:1},e)}}class n extends HTMLElement{constructor(){super();const e=this,t=e.attachShadow({mode:"open"}),n=document.createElement("div");n.setAttribute("id","client"),n.lgxyWidth=n.lgxyHeight=0,t.append(document.createElement("style"),document.createElement("style"),n),Object.defineProperty(e,"param",{value:Object.create(new i(e))}),e.resizeObserver=new window.ResizeObserver((t=>{t.forEach((t=>{let i,s;t.borderBoxSize?(i=t.borderBoxSize[0].inlineSize,s=t.borderBoxSize[0].blockSize):(i=t.contentRect.width,s=t.contentRect.height),n.lgxyWidth=Math.round(i),n.lgxyHeight=Math.round(s),e.update("level")}))})),this.resizeObserver.observe(n)}connectedCallback(){const e=this;e._isRender||(e.param.set(),e.update("strip"),this.shadowRoot.childNodes[2].innerHTML="<slot></slot>",e.event(),Object.defineProperty(e,"_isRender",{value:!0}))}disconnectedCallback(){this.resizeObserver.disconnect(),this.event(!1)}adoptedCallback(){}static get observedAttributes(){return["param"]}attributeChangedCallback(t,i,n){let s=this.param.changedCallback(n,((t,i,n,s)=>{const l=typeof i;if("number"===l)i=Math.max(s,e.int(i));else if("string"===l){let e=e=>!e.includes(i);("xSide"===t&&e(["n","s","none","none-n","none-s"])||"ySide"===t&&e(["w","e","none","none-w","none-e"])||"xDepend"===t&&e(["directly","inverse"])||"yDepend"===t&&e(["directly","inverse"]))&&(i=n)}return i}),(e=>{["x","y"].forEach((t=>{let i=t in e?e[t]:0,n=Math.max(0,(t+"Qty"in e?e[t+"Qty"]:0)-1);i>n&&(e[t]=n)}))}));Object.keys(s).length&&this._isRender&&(this.update(("xSide"in s||"ySide"in s||"xHide"in s||"yHide"in s?"strip ":"")+"level"),this.dispatchEvent(new CustomEvent("lgxy",{detail:s,bubbles:!1,cancelable:!1})))}event(t=!0){if(t&&!this._eventList){let t=this;Object.defineProperty(this,"_eventList",{value:Object.create({},{down:{value:i=>function(t,i){if(t.target!==i)return;if(!e.isTouch()&&t.which>1)return;let n=e.isTouch()?t.changedTouches[0]:t,s=n.clientX,l=n.clientY;t.preventDefault();let a=i.shadowRoot.getElementById("client").getBoundingClientRect(),o=i.param,r=["n","none-n","none","none-s","s"].indexOf(o.xSide)-2,d=["w","none-w","none","none-e","e"].indexOf(o.ySide)-2,c=r>0?l>Math.trunc(a.bottom):l<=Math.trunc(a.top),h=d>0?s>Math.trunc(a.right):s<=Math.trunc(a.left);function u(t="remove"){t+="EventListener",e.isTouch()?(i[t]("touchmove",f,{passive:!1}),i[t]("touchend",p,!1),i[t]("touchcancel",p,!1)):(i[t]("mousemove",f),i[t]("mouseup",p),i[t]("mouseleave",p)),window[t]("resize",p,!1)}function p(){u()}function f(t){let i=e.isTouch()?t.changedTouches[0]:t,n=i.clientX,s=i.clientY;t.preventDefault(),g(n,s)}function g(e,t){if(!d||c&&!h){let t=e<=a.left?0:e>=a.right-1?o.xQty:Math.ceil((e-a.left)*o.xQty/a.width);o.x=(d>-1?"inverse"===o.xDepend:"directly"===o.xDepend)?t-1:o.xQty-t}if(!r||h&&!c){let e=t<=a.top?0:t>=a.bottom-1?o.yQty:Math.ceil((t-a.top)*o.yQty/a.height);o.y=(r>-1?"inverse"===o.yDepend:"directly"===o.yDepend)?e-1:o.yQty-e}}g(s,l),u("add")}(i,t)},wheel:{value:e=>function(e,t){if(e.ctrlKey||e.altKey||e.buttons)return;let i=e.deltaY>0?1:-1,n=t.param;e.shiftKey?n.x+=i*n.xStep:n.y+=i*n.yStep}(e,t)}})})}let i=this._eventList,n=(t?"add":"remove")+"EventListener";this[n](e.isTouch()?"touchstart":"mousedown",i.down,!1),this[n]("wheel",i.wheel,{passive:!1})}update(e="level"){const t=this,i=t.param;let n=["n","none-n"].includes(i.xSide)?-1:1,s=["w","none-w"].includes(i.ySide)?-1:1;const l=t.shadowRoot.childNodes;if(e.includes("strip")){let e=!i.xHide&&!i.xSide.includes("none"),a=!i.yHide&&!i.ySide.includes("none");l[0].textContent=`\n:host {\n  --color-xy: var( --lgxy-color-xy, transparent ) !important;\n  --color-level: var( --lgxy-color-level, rgba(100,100,100,0.3) );\n  --color-hover: var( --lgxy-color-hover, rgba(100,100,100,0.7) ) !important;\n  --wxy:${e||a?"calc( var( --lgxy-width, 0.8vw ) + 0px)":"0px"} !important;\n  --wx: ${e?"var( --wxy )":"0px"} !important;\n  --wy: ${a?"var( --wxy )":"0px"} !important;\n  \n  position: ${t.parentElement&&"body"===t.parentElement.localName?"fixed":"relative"};\n  display: flex !important;\n  flex-direction: column !important;\n  ${n>0?"":"justify-content: flex-end !important;"}\n  overflow: hidden !important;\n  contain: layout !important;\n  box-shadow: var(--color-xy) ${-s}px ${-n}px 1px ,\n              var(--color-xy) calc(${-.75*s} * var(--wy)) calc( ${-.75*n} * var(--wx))\n              var(--wxy) inset !important;\n  top: 0;\n  left: 0;\n  width:  100%;\n  height: 100%;\n}\n\n#client {\n  flex-shrink: 0;\n  align-self: flex-${s>0?"start;":"end;"}\n  position: relative;\n  width:  calc( 100% - var(--wy) );\n  height: calc( 100% - var(--wx) );\n  contain: size layout;\n}\n\n:host(:hover) {\n  --color-level: var(--color-hover);\n}`}if(e.includes("level")){let e=i.x,a=i.xQty,o=i.y,r=i.yQty,d="inverse"===i.xDepend?e+1:a-e-1,c="inverse"===i.yDepend?o+1:r-o-1,h=t.shadowRoot.childNodes[2],u=h.lgxyWidth,p=h.lgxyHeight,f=a?d===a?u:Math.ceil(d*u/a):0,g=r?c===r?p:Math.ceil(c*p/r):0;l[1].textContent=`\n#client {\n  box-shadow:\n    var(--color-level) ${.5*s}px ${.5*n}px 1px 0px ,\n    var(--color-level) ${s*u}px ${n*p}px 0px 0px ,\n    var(--color-level) calc( ${s} * ( var(--wxy) + ${f}px)) calc(${n} * (var(--wxy) + ${g}px)) 0px var(--wxy);\n}`}}}window.customElements.define("lgxy-box",n);const s=()=>{class i extends t{constructor(e){super({lgxy:"auto",gapCol:2,gapRow:2,rowHeight:22,headingHeight:24,footingHeight:0,divisionLine:2,go:"s"},e)}}class s{constructor(e){Object.defineProperty(this,"tds",{value:e}),Object.defineProperty(this,"list",{value:[]})}add(e={},t=this.list.length,i=!1){const n=this.tds,s=this.list.length,l=function(e,t){const i={id:"col"+e,width:100,widthMin:20,widthMax:null,head:void 0,headSay:void 0,when:()=>!1,cell:void 0,cellSay:void 0,cellGet:void 0,sortKey:void 0,foot:"",footSay:void 0,renew:[e=>e,0],shadow:!1,hidden:!1};return Object.assign(i,t),i.head||(i.head=i.id),i.headSay||(i.headSay=i.head),i.cellSay||(i.cellSay=i.cell),i.cellGet||(i.cellGet=i.cell),i.sortKey||(i.sortKey=i.cell),i.footSay||(i.footSay=i.foot),n.records.sortSet[i.id]=i.sortKey,delete i.sortKey,i.widthMin<6&&(i.widthMin=6),null!==i.widthMax&&i.widthMax<i.widthMin&&(i.widthMax=i.widthMin),i.width<i.widthMin&&(i.width=i.widthMin),null!==i.widthMax&&i.width>i.widthMax&&(i.width=i.widthMax),i}(s,e);!function(e,t,i){const n=e.links.templateCol.cloneNode();n.setAttribute("data-col",t),n.id=i.id,n.hidden=!0;const s=n.cloneNode();s.innerHTML="string"==typeof i.headSay?i.headSay:i.headSay(),s.classList.add("-tds-heading-col");const l=n.cloneNode();l.innerHTML=i.footSay,l.classList.add("-tds-footing-col"),e.links.headingSlide.append(s),e.links.footingSlide.append(l),e.links.templateRow.Slide.append(n.cloneNode());for(let t=0;t<e.rowMax+1;t++)e.links.dataSlide.children[t].append(n.cloneNode())}(n,s,l),this.list.push(l),l.hidden||n.listX.splice(n.listX.length-(i?0:n.fixedRight),0,s),n.xMax>-1&&n.updateData(void 0,void 0,s),null!==t&&(n.controlCol(!0,t),n.render=1)}moveLeft(){const e=this.tds,t=e.listX,i=e.x;i>(i<e.xLeft?0:i<e.xRight?e.xLeft:e.xRight)&&([t[i-1],t[i]]=[t[i],t[i-1]],e.controlCol(!1))}moveRight(){const e=this.tds,t=e.listX,i=e.x;i<(i<e.xLeft?e.xLeft-1:i<e.xRight?e.xRight-1:t.length-1)&&([t[i],t[i+1]]=[t[i+1],t[i]],e.controlCol(!1))}moveOff(){const e=this.tds,t=e.listX;let i=t.slice(0,e.xLeft).sort(((e,t)=>e-t)),n=t.slice(e.xRight).sort(((e,t)=>e-t)),s=t.slice(e.xLeft,e.xRight).sort(((e,t)=>e-t));i.concat(s,n).forEach(((e,i)=>t[i]=e)),e.controlCol(!1)}pinnedLeft(){const e=this.tds,t=e.listX,i=e.x,n=t[i];let s;if(s=i<e.xLeft){let s=t.slice(e.xLeft,e.xRight);s.push(n),s.sort(((e,t)=>e-t)),t.splice(e.xLeft-1+s.indexOf(t[i]),0,t.splice(i,1)[0]),e.fixedLeft--}else(s=i>=e.xRight)?(t.splice(e.xLeft,0,t.splice(i,1)[0]),e.fixedLeft++,e.fixedRight--):(s=e.xRight-e.xLeft>1)&&(t.splice(e.xLeft,0,t.splice(i,1)[0]),e.fixedLeft++);s&&e.controlCol()}pinnedRight(){const e=this.tds,t=e.listX,i=e.x,n=t[i];let s;if(s=i>=e.xRight){let s=t.slice(e.xLeft,e.xRight);s.push(n),s.sort(((e,t)=>e-t)),t.splice(e.xLeft+s.indexOf(t[i]),0,t.splice(i,1)[0]),e.fixedRight--}else(s=i<e.xLeft)?(t.splice(e.xRight-1,0,t.splice(i,1)[0]),e.fixedLeft--,e.fixedRight++):(s=e.xRight-e.xLeft>1)&&(t.splice(e.xRight-1,0,t.splice(i,1)[0]),e.fixedRight++);s&&e.controlCol()}fixedLeft(){const e=this.tds,t=e.x,i=e.listX;if(t<e.xLeft){let n=i.slice(t,e.xRight).sort(((e,t)=>e-t));i.splice(t,e.xLeft-t).sort(((e,t)=>e-t)).forEach((e=>{i.splice(t+n.indexOf(e),0,e)}))}else t>=e.xRight&&(e.fixedRight-=t-e.xRight);e.fixedLeft!==t&&(e.fixedLeft=t,e.controlCol())}fixedRight(){const e=this.tds,t=e.listX,i=e.xMax-e.x,n=i?e.x:t.length-1;if(n>=e.xRight){let i=t.slice(e.xLeft,n+1).sort(((e,t)=>e-t));t.splice(e.xRight,n-e.xRight+1).sort(((e,t)=>e-t)).forEach((n=>{t.splice(e.xLeft+i.indexOf(n),0,n)}))}else n<e.xLeft&&(e.fixedLeft=n);e.fixedRight!==i&&(e.fixedRight=i,e.controlCol())}shadow(){const e=this.list,t=this.tds,i=t.listX[t.x];e[i].shadow=!e[i].shadow,t.controlCol()}hidden(e){const t=this.tds,i=t.listX,n="number"==typeof e?i.indexOf(e):t.x,s=t.xRight,l=t.xLeft;if(n<0);else if(n>=s||n<l||s-l>1){let e;i.splice(n,1),(e=n>=s)?t.fixedRight--:(e=n<l)?t.fixedLeft--:e=s-l>1,e&&t.controlCol()}}hiddenOff(e){const t=this.list,i=this.tds,n=i.listX,s=n.indexOf(e);if(e>-1&&e<t.length&&!~s){let t=n.slice(i.xLeft,i.xRight);t.push(e),t.sort(((e,t)=>e-t)),n.splice(i.xLeft+t.indexOf(e),0,e),i.controlCol(!0,e)}}}class l{constructor(e){Object.defineProperty(this,"tds",{value:e}),Object.defineProperty(this,"sortSet",{value:{}}),Object.defineProperty(this,"sortApply",{value:[]});const t=(e,t)=>{switch(typeof e){case"string":return t[e]+"";case"function":return e(t)+"";default:return""}};Object.defineProperty(this,"filterSet",{value:{tds0:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),n.includes(s)},tds1:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),n===s},tds2:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),isNaN(+n)||isNaN(+s)?n>s:+n>+s},tds3:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),isNaN(+n)||isNaN(+s)?n<s:+n<+s},tds4:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),(isNaN(+n)||isNaN(+s)?n>s:+n>+s)||n===s},tds5:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),(isNaN(+n)||isNaN(+s)?n<s:+n<+s)||n===s},tds6:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),n!==s},tds7:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),n=n.slice(0,s.length),n===s},tds8:(e,i)=>{let n=t(e.cell,i),s=e.compare;return e.loose&&(n=n.trim().toLowerCase(),s=s.trim().toLowerCase()),!n.includes(s)}}}),Object.defineProperty(this,"filterApply",{value:[]})}sort(e,t=1,i=!1){const n=this.tds;e||=n.columns.list[n.listX[n.x]].id,this.sortMulty([{tag:e,mode:t}],i)}sortMulty(e=[],t=!1){const i=this.sortSet,n=this.sortApply,s=n.length;t||(n.length=0),e.forEach((e=>{if(e.tag in i){let t="mode"in e?e.mode:1,i=n.findIndex((t=>t.tag===e.tag));i>-1?t?n[i].mode=t:n.splice(i,1):t&&n.push({tag:e.tag,mode:t})}else console.error(`TDS.records: sortMulty() tag "${e.tag}" не зарегестрирован в sortSet`)})),n.length?this.sortRefrech():s&&this.sortOff()}sortRefrech(){const e=this.tds,t=e.listY,i=this.sortApply,n=this.sortSet;if(!i.length||!t.length)return;let s=t[e.y],l=(e,t)=>{switch(typeof e){case"string":return t[e]+"";case"function":return e(t)+"";default:return""}};const a=e.data;let o=i.map((e=>{let t=n[e.tag],i=l(t,a[s]);return{values:[],mode:e.mode,key:t,type:isNaN(+i)?"string":"number"}})),r=o.length;o.push([]),t.forEach(((e,t)=>{o[r].push([t,e]);let i=a[e];o.forEach(((e,t)=>{if(t<r){let n=l(e.key,i);o[t].values.push("string"===e.type?n.toUpperCase():+n)}}))})),o[r].sort(((e,t)=>{let i;for(let a=0;a<r&&(n=o[a].values[e[0]],s=o[a].values[t[0]],l=o[a].mode,!(i=n<s?-l:n>s?l:0));a++);var n,s,l;return i})),t.length=0,o[r].forEach((e=>t.push(e[1]))),e.updateData(),e.y=t.indexOf(s)}sortOff(){const e=this.tds,t=e.listY,i=this.sortApply;let n=t[e.y];t.sort(((e,t)=>e-t)),i.length=0,e.updateData(),e.y=t.indexOf(n)}filter(e="tds0",t={},i=!1){return this.filterMulty([{tag:e,param:t}],i)}filterMulty(e=[],t=!1){const i=this.tds,n=i.columns.list,s=this.filterSet,l=this.filterApply;let a=0;return t||(l.length=0),e.forEach((e=>{if(e.tag in s)if("tds"===e.tag.slice(0,3)){let t=i.listX[i.x];"colId"in e.param?t=n.findIndex((t=>t.id===e.param.colId)):e.param.colId=n[t].id,t<0?console.error(`TDS.records: filterMulty() столбец с colId "${e.param.colId}" не зарегестрирован в TDS.columns`):(e.param.cell=n[t].cell,"loose"in e.param||(e.param.loose=!0),"compare"in e.param||(e.param.compare=""),e.param.compare+="",l.push(e),a++)}else l.push(e),a++;else console.error(`TDS.records: filterMulty() tag "${e.tag}" не зарегестрирован в filterSet`)})),(t?i.listY.length:i.data.length)?t?a?this.filterRefrech(a):-1:a?this.filterRefrech():this.filterOff()||-1:-1}filterRefrech(e=0){const t=this.tds,i=t.data,n=t.listY,s=this.filterSet,l=this.filterApply;let a=n[t.y];const o=[];if(e){let t=l.slice(-e);n.forEach((e=>{t.find((t=>!(0,s[t.tag])(t.param,i[e])))||o.push(e)}))}else i.forEach(((e,t)=>{l.find((t=>!(0,s[t.tag])(t.param,e)))||o.push(t)}));return n.length=0,o.forEach((e=>n.push(e))),t.lgxy.param.group={yQty:n.length,y:Math.max(n.indexOf(a),0)},t.updateData(),n.length}filterOff(){const e=this.tds,t=e.data,i=e.listY,n=i[e.y],s=this.filterApply;i.length=0,t.forEach(((e,t)=>i.push(t))),s.length=0,e.lgxy.param.group={yQty:i.length,y:Math.max(i.indexOf(n),0)},this.sortRefrech()}current(){const e=this.tds.listY[this.tds.y];return{recno:e,data:this.tds.data[e]}}append(e){const t=this.tds,i=t.data,n=t.listY;i.push(e),n.push(i.length-1),t.lgxy.param.group={yQty:n.length,y:Math.max(n.length-1,0)},this.sortRefrech()}change(e){const t=this.tds.listY[this.tds.y],i=this.tds.data[t];for(let n in i)n in e&&(this.tds.data[t][n]=e[n]);this.tds.updateData(this.tds.row,this.tds.row),this.sortRefrech()}delete(){const e=this.tds,t=e.data,i=e.listY,n=i[e.y];t.splice(n,1),i.splice(e.y,1),i.forEach(((e,t)=>{e>n&&(i[t]=e-1)})),e.lgxy.param.group={yQty:i.length,y:e.y}}}class a extends HTMLElement{constructor(){super();const t=this;Object.defineProperty(t,"render",{writable:!0,value:-1});const s=new n,l=document.createElement("div");l.setAttribute("class","-tds-table");let a=document.createElement("style"),o=[a,a.cloneNode(),a.cloneNode(),a.cloneNode(),a.cloneNode(),s];Object.defineProperty(t,"lgxy",{value:s}),Object.defineProperty(t,"links",{value:{table:l}}),["heading","data","footing"].forEach((i=>{let n=document.createElement("div");n.setAttribute("class","-tds-"+i);let s=new Array(3);["left","slide","right"].forEach(((n,l)=>{let a;s[l]=document.createElement("div"),s[l].setAttribute("class","-tds-"+n),"data"===i?(a=document.createElement("div"),a.classList.add("-tds-roll"),s[l].append(a)):"heading"===i?(a=document.createElement("div"),a.classList.add("-tds-roll","-tds-heading-row"),s[l].append(a)):"footing"===i?(a=document.createElement("div"),a.classList.add("-tds-roll","-tds-footing-row"),s[l].append(a)):a=s[l],t.links[i+e.up0(n)]=a})),n.append(...s),l.append(n)})),s.append(l),t.attachShadow({mode:"open"}).append(...o);const r=t.links.dataSlide.parentElement;r.tdsWidth=0,r.tdsHeight=0,t.links.client=r,t.resize=()=>{},t.resizeObserver=new window.ResizeObserver((e=>{let i=0,n=0;e.forEach((e=>{let s,l;e.borderBoxSize?(s=Math.round(e.borderBoxSize[0].inlineSize),l=Math.round(e.borderBoxSize[0].blockSize)):(s=Math.round(e.contentRect.width),l=Math.round(e.contentRect.height)),i=s-(r.tdsWidth||0),n=l-(r.tdsHeight||0),r.tdsWidth=s,r.tdsHeight=l,t.render>0&&(i&&t.controlCol(!1,-1,i),n&&t.controlRow(!0,n),(i||n)&&window.setTimeout((()=>t.resize(s,l)),0))}))})),t.resizeObserver.observe(r),Object.defineProperty(t,"param",{value:Object.create(new i(t))});let d=document.createElement("div");d.classList.add("-tds-row"),t.links.templateRow={Slide:d,Left:d.cloneNode(!1),Right:d.cloneNode(!1)};let c=document.createElement("div");c.classList.add("-tds-cell"),t.links.templateCol=c}connectedCallback(){const e=this;if(e.render<0){e.tabIndex=0,e.param.set(),["hidden","auto"].includes(e.param.lgxy)&&(e.lgxy.param.group={xHide:!0,yHide:!0}),Object.defineProperty(e,"columns",{value:new s(e)}),Object.defineProperty(e,"records",{value:new l(e)}),Object.defineProperty(e,"listX",{value:[]}),Object.defineProperty(e,"listY",{value:[]}),Object.defineProperty(e,"fixedLeft",{writable:!0,value:0}),Object.defineProperty(e,"fixedRight",{writable:!0,value:0});const t=getComputedStyle(e),i=/"+/g,n=e=>t.getPropertyValue(e).replace(i,"");Object.defineProperty(e,"paramRoll",{value:{rows:0,hideRow:0,row:0,left:0,top:0,cssCursor:n("--tds-cursor-focusout"),cssActive:n("--tds-cursor-focusin"),cssLine:n("--tds-cursor-line"),cssShadow:n("--tds-col-shadow"),cssHeading:n("--tds-cell-heading"),cssData:n("--tds-cell-data"),cssFooting:n("--tds-cell-footing")}}),e.updateStyle("init"),e.event(),e.render=0}}disconnectedCallback(){this.resizeObserver.disconnect(),this.event(!1)}adoptedCallback(){}static get observedAttributes(){return["param"]}attributeChangedCallback(t,i,n){const s=this;let l,a,o,r,d=s.param.changedCallback(n,((t,i,n,s)=>("number"==typeof i?i=Math.max(e.int(i),t.includes("gap")||t.includes("Height")?0:s):("lgxy"===t&&!["auto","visible","hidden"].includes(i)||"go"===t&&!["s","r","d","l","u"].includes(i))&&(i=n),i)),(()=>{}));if(Object.keys(d).length&&!(s.render<1)&&s.columns.list.length){if("lgxy"in d)if("auto"===d.lgxy.new)a=o=!0;else{let e="hidden"===d.lgxy.new;s.lgxy.param.group={xHide:e,yHide:e}}"gapCol"in d&&(l=a=!0),("gapRow"in d||"rowHeight"in d)&&(l=r=!0),("headingHeight"in d||"footingHeight"in d||"divisionLine"in d)&&(l=!0),l&&s.updateStyle("init"),a&&s.controlCol(!1),r?s.controlRow(!0):o&&s.controlRow(!1),s.dispatchEvent(new CustomEvent("tds",{detail:d,bubbles:!1,cancelable:!1}))}}set row(e){this.paramRoll.row=e<0||this.rowMax<0?0:e>this.rowMax?this.rowMax:e}get row(){return this.paramRoll.row}get rowMax(){return this.paramRoll.rows-1}set x(e){this.lgxy.param.x=e}get x(){return this.lgxy.param.x}set xMax(e){this.lgxy.param.xQty=e+1}get xMax(){return this.lgxy.param.xQty-1}get xLeft(){return this.fixedLeft}get xRight(){return this.listX.length-this.fixedRight}set y(e){this.lgxy.param.y=e}get y(){return this.lgxy.param.y}set yMax(e){this.lgxy.param.yQty=e+1}get yMax(){return this.lgxy.param.yQty-1}get yBeginSlide(){return this.y-this.row}get yEndSlide(){return this.yBeginSlide+this.rowMax}set data(e){const t=this;t._data=e;const i=t.listY;i.length=0,e.forEach(((e,t)=>{i.push(t)})),t.render>0&&(t.lgxy.param.group={yQty:e.length,y:0},t.updateData())}get data(){return this._data}use(e){if("object"!=typeof e)return;const t=this;t.render=0,t.data=e.data,"hrefCSS"in e&&fetch(e.hrefCSS).then((e=>e.text())).then((e=>t.shadowRoot.childNodes[4].textContent=e)),t.fixedLeft="fixedLeft"in e?e.fixedLeft:0,t.fixedRight="fixedRight"in e?e.fixedRight:0;for(let i in t.param.default)i in e&&(t.param[i]=e[i]);if("columns"in e&&e.columns.length>0){"data"in e||(e.data=[]);for(let i=0;i<e.columns.length;i++)t.columns.add(e.columns[i],null,!0)}else{if(!("data"in e&&Array.isArray(e.data)&&e.data.length))return;{const i=e.data[0];let n=0;for(let e in i){const s=e,l=i[s];t.columns.add({id:s,head:s,cell:s,cellSay:e=>`<span class="-tds-type-${typeof l}">${e[s]}</span>`,width:100},null,!0),n++}}}t.updateStyle("init"),t.controlCol(!0,0),t.lgxy.param.group={yQty:e.data.length,y:0},t.render=1}updateData(e=0,t=this.rowMax,i=-1){if(t<e)return;const n=this;let s=(e,t)=>{let i=n.data[n.listY[e]];switch(typeof t){case"string":return i[t];case"function":return t(i);default:return""}},l=(e,t)=>{let i=n.yBeginSlide+e,l=[].concat(Array.from(n.links.dataLeft.children[e].children),Array.from(n.links.dataSlide.children[e].children),Array.from(n.links.dataRight.children[e].children)),a=[];for(let e=0;e<l.length;e++){let o=l[e],r=+o.dataset.col;if(t<0||t===r){let e=n.columns.list[r].cellSay;a.push({cell:o,content:s(i,e)})}if(t===r)break}return a},a=[];for(let n=e;n<t+1;n++)a.push(l(n,i));a.forEach((e=>e.forEach((e=>e.cell.innerHTML=e.content))))}controlRow(e=!0,t=0){const i=this;if(!i.columns.list.length)return;let n=i.paramRoll.rows;e&&function(){const e=i.param.rowHeight,s=i.param.gapRow,l=i.paramRoll;t||(l.top=0);let a=l.top,o=i.row,r=i.links.client.tdsHeight,d=e+s,c=e>0?Math.min(i.listY.length,Math.ceil(r/d)):0;l.rows=c;let h=(c?c*d-s:0)-r;l.hideRow=h;let u=n-o-1,p=i.yMax-i.y-u,f={slide:i.links.dataSlide,left:i.links.dataLeft,right:i.links.dataRight},g={ins:0,del:0},m=c-n;if(m<0){for(let e=0;e<-m;e++){let t=!e&&a>0||e>=u?"firstChild":"lastChild";f.left[t].remove(),f.slide[t].remove(),f.right[t].remove(),"firstChild"===t&&(g.del++,o--)}i.row=o}else if(m>0){let e=i.links.templateRow,t={pre:{slide:[],left:[],right:[]},add:{slide:[],left:[],right:[]}};for(let i=0;i<m;i++){let n=i<p?"add":"pre";t[n].left.push(e.Left.cloneNode(!0)),t[n].slide.push(e.Slide.cloneNode(!0)),t[n].right.push(e.Right.cloneNode(!0))}g.ins=t.pre.slide.length,g.ins&&(f.left.prepend(...t.pre.left),f.slide.prepend(...t.pre.slide),f.right.prepend(...t.pre.right),o+=g.ins,i.row=o,i.updateData(0,g.ins-1)),t.add.slide.length&&(f.left.append(...t.add.left),f.slide.append(...t.add.slide),f.right.append(...t.add.right),i.updateData(c-t.add.slide.length,c-1))}if(m>0||t>0){let n=i.listY.length*d-s;if(g.ins)a=i.yBeginSlide?h:h<0?0:h;else if(a>0){let i=e-1;a=i-(i-a+Math.min(t,a))%d}i.yBeginSlide*d+a>0&&(!g.ins&&a<0&&(a=(s+a+Math.min(t,-a))%d-s),n-(i.yBeginSlide*d+a)-r<=0&&(a=h))}else(m<0||t<0)&&(g.del?a=~i.rowMax?h:0:a>0&&(a=(s+a+Math.min(-t,a))%d-s),(i.row+1)*d-s+(a<0?-a:a)>=r&&(a=h));l.top=a}(),e&&(t>0&&!n||!t)?i.cursor():i.updateStyle("scroll-row")}controlCol(e=!0,t=-1,i=0){const n=this,s=n.listX,l=n.columns.list;(e=function(e){l.forEach((e=>e.hidden=!0));let t=[],i=l.length-1;for(let n=s.length-1;n>-1;n--){let a=s[n];a>i||a<0||t.includes(a)?(s.splice(n,1),e=!0):(t.push(a),l[a].hidden=!1)}const a=Math.max(s.length-1,0);return n.fixedLeft>a&&(e=!0,n.fixedLeft=a),n.fixedRight>a-n.fixedLeft&&(e=!0,n.fixedRight=a-n.fixedLeft),e}(e))&&function(){const e=n.fixedLeft,t=n.fixedRight;let i=n.links.templateRow,a={Left:Array.from(i.Left.children,(e=>+e.dataset.col)),Slide:Array.from(i.Slide.children,(e=>+e.dataset.col)),Right:Array.from(i.Right.children,(e=>+e.dataset.col))},o=((e,t,i)=>{let s={Left:[],Slide:[],Right:[]},l=e.length,a=n.columns.list.length;for(let i=0;i<t;i++)s.Left[i]=e[i];s.Left.sort(((e,t)=>e-t));for(let t=l-i;t<l;t++)s.Right.push(e[t]);s.Right.sort(((e,t)=>e-t));for(let e=0;e<a;e++)s.Left.includes(e)||s.Right.includes(e)||s.Slide.push(e);return s})(s,e,t),r=(e,t)=>{let s=[];s.push(i[e].children[t]),s.push(n.links["heading"+e].children[t]);let l=n.links["data"+e].children;for(let e=0;e<n.rowMax+1;e++)s.push(l[e].children[t]);return s.push(n.links["footing"+e].children[t]),s};const d="-tds-col-shadow";["Left","Right","Slide"].forEach((e=>{for(let t=0;t<a[e].length;t++){const n=a[e][t],s=i[e].children[t],o=l[n].shadow,c=s.classList.contains(d),h=l[n].hidden,u=s.hidden;o===c&&h===u||r(e,t).forEach((e=>{o&&!c?e.classList.add(d):!o&&c&&e.classList.remove(d),h&&!u?e.hidden=!0:!h&&u&&(e.hidden=!1)}))}}));let c=[],h=(e,t,i,n,s)=>{c.push({mode:e,fromSele:t,fromPos:i,toSele:n,toPos:s})};["Left","Right","Slide"].forEach(((e,t)=>{let i=["Left","Right","Slide"];i.splice(t,1);for(let t=0;t<a[e].length;t++){const n=a[e][t];if(!o[e].includes(n)){a[e].splice(t,1);let s=o[i[0]].includes(n)?i[0]:o[i[1]].includes(n)?i[1]:"";if(s){let i=a[s].findIndex((e=>e>n)),l=~i?"before":"append";~i?a[s].splice(i,0,n):a[s].push(n),h(l,e,t,s,i),t--}}}}));let u=n.paramRoll.rows;c.forEach((e=>{let[t,s,l,a,o]=[e.mode,e.fromSele,e.fromPos,e.toSele,e.toPos],[r,d]=[n.links["heading"+a],n.links["heading"+s]],[c,h]=[n.links["footing"+a],n.links["footing"+s]],[p,f]=[n.links["data"+a],n.links["data"+s]];if("append"===t){r.append(d.children[l]),c.append(h.children[l]);for(let e=0;e<u;e++)p.children[e].append(f.children[e].children[l]);i[a].append(i[s].children[l])}else{r.children[o].before(d.children[l]),c.children[o].before(h.children[l]);for(let e=0;e<u;e++)p.children[e].children[o].before(f.children[e].children[l]);i[a].children[o].before(i[s].children[l])}})),n.xMax-s.length+1&&(n.xMax=s.length-1)}(),n.updateStyle("cols"+(i?"+scroll-col":""));const a=n.links.currentCell,o=n.fixedLeft;setTimeout((()=>{let e=~t?s.indexOf(t):a?s.indexOf(+a.dataset.col):o;e<0||~t&&n.x===e?n.cursor():n.x=e}),0)}cursor(){const e=this;let t=e.links.currentCell,i=e.links.currentLine;if(t&&(t.classList.remove("-tds-cursor","-tds-active"),i.left.classList.remove("-tds-line"),i.slide.classList.remove("-tds-line"),i.right.classList.remove("-tds-line"),i=void 0),!~e.rowMax)return;let n,s=e.listX,l=e.x,a=e.row,o=l<e.xLeft?"dataLeft":l<e.xRight?"dataSlide":"dataRight",r=s[l],d=e.links[o].children[a].children;for(let e=0;e<d.length;e++)if(+d[e].dataset.col===r){n=d[e];break}e.links.currentCell=n,n&&(i={left:e.links.dataLeft.children[a],slide:e.links.dataSlide.children[a],right:e.links.dataRight.children[a]},i.left.classList.add("-tds-line"),i.slide.classList.add("-tds-line"),i.right.classList.add("-tds-line"),e.links.currentLine=i,n.classList.add("-tds-cursor"),document.activeElement===e&&n.classList.add("-tds-active"),0===e.row&&e.rowMax>0?e.paramRoll.top=0:e.row===e.rowMax&&(e.paramRoll.top=Math.max(e.paramRoll.hideRow,0)),this.updateStyle("scroll-col+scroll-row "))}event(t=!0){if(t&&!this._eventList){let t=this;Object.defineProperty(this,"_eventList",{value:Object.create({},{lgxy:{value:e=>function(e,t){document.activeElement!==t&&("x"in e.detail||"y"in e.detail)&&t.focus();let i,n=!1;if(i="yQty"in e.detail){t.controlRow(!0);let i="y"in e.detail?e.detail.y.new:t.y;i>t.rowMax?t.yEndSlide>t.yMax&&(t.row+=t.yEndSlide-t.yMax):t.row=i,n=!0}else if("y"in e.detail){let s=e.detail.y.ask<0,l=!e.detail.y.new,a=e.detail.y.new===t.yMax,o=e.detail.y.ask>e.detail.y.new,r=e.detail.y.new-e.detail.y.old,d=s&&!l||o&&!a||t.row+r<0||t.row+r>t.rowMax;r&&(s||l?t.row=0:o||a?t.row=t.rowMax:d?t.yBeginSlide<0?t.row+=t.yBeginSlide:t.yEndSlide>t.yMax&&(t.row+=t.yEndSlide-t.yMax):t.row+=r,d&&(i=!0),n=!0)}"x"in e.detail&&e.detail.x.new===e.detail.x.ask&&(n=!0),i&&t.updateData(),n&&t.cursor()}(e,t)},keydown:{value:e=>function(e,t){let i=!0,n=e.key;switch(e.ctrlKey||e.altKey||!(e.code.includes("Key")||e.code.includes("Digit")||e.code.includes("Numpad")||["Backquote","Minus","Equal","IntlYen","BracketLeft","BracketRight","Backslash","Semicolon","Quote","IntlBackslash","Comma","Period","Slash","IntlRo"].includes(e.code))||(n="Enter"),n){case"ArrowRight":t.x++;break;case"ArrowLeft":t.x--;break;case"ArrowDown":e.ctrlKey?t.y=t.yMax:t.y++;break;case"ArrowUp":e.ctrlKey?t.y=0:t.y--;break;case"Home":e.ctrlKey?t.lgxy.param.group={x:0,y:0}:t.x=0;break;case"End":e.ctrlKey?t.lgxy.param.group={x:t.xMax,y:t.yMax}:t.x=t.xMax;break;case"PageDown":t.y+=t.paramRoll.rows-(t.paramRoll.hideRow>0?1:0);break;case"PageUp":t.y-=t.paramRoll.rows-(t.paramRoll.hideRow>0?1:0);break;case"Enter":let n=t.columns.list,s=t.listX,l=t.param.go,a=e=>{let t=0;if("r"===l){let i=s.length;for(let l=e;l<i&&n[s[l]].shadow;l++)t++;t===i-e&&(t=null)}else if("l"===l){for(let i=e;i>-1&&n[s[i]].shadow;i--)t--;e+1+t!==0&&(t=null)}return t},o=!1;if("r"===l||"l"===l){let e=a(t.x);e&&(t.x+=e,o=!0)}let r=n[s[t.x]],d=t.data[t.listY[t.y]],c=!r.shadow&&r.when(d);if("s"===l);else if("d"===l)t.y++;else if("u"===l)t.y--;else if(c||!o){let e="r"===l?1:-1,i=a(t.x+e);null===i||(t.x+=e+i)}break;default:i=!1}i&&e.preventDefault()}(e,t)},down:{value:i=>s(i,t,e.isTouch()?"touchstart":"mousedown")},dbldown:{value:e=>s(e,t,"dblclick")},focus:{value:()=>{let e=t.links.currentCell;e&&!e.classList.contains("-tds-active")&&e.classList.add("-tds-active")}},blur:{value:()=>{let e=t.links.currentCell;e&&e.classList.contains("-tds-active")&&e.classList.remove("-tds-active")}}})})}let i=this._eventList,n=(t?"add":"remove")+"EventListener";function s(t,i,n){if(t.target!==i)return;if(!e.isTouch()&&t.which>1)return;t.preventDefault(),document.activeElement!==i&&i.focus();let s=(e=>{for(;e&&(e.classList.value.includes("-tds-type")||!e.classList.value.includes("-tds-"));)e=e.parentElement;return e})(t.composedPath()[0]),l=s?s.classList.value:"";if(l.includes("-tds-heading-col")){let a=t.clientX;i.x=i.listX.indexOf(+s.dataset.col);let o=i.columns.list[+s.dataset.col];function r(e){e.preventDefault();let t=e.clientX-a;a=e.clientX;let n=!1,s=o.width;s+t<o.widthMin&&(t=o.widthMin-s,n=!0),null!==o.widthMax&&s+t>o.widthMax&&(t=o.widthMax-s,n=!0),t&&(o.width=s+t,i.controlCol(!1)),n&&d()}function d(){s.removeEventListener("mouseleave",d),s.removeEventListener("mouseup",d),s.removeEventListener("mousemove",r),i.event(),s.style.cursor=""}"mousedown"===n&&o.widthMin!==o.widthMax&&(s.style.cursor="col-resize",i.event(!1),s.addEventListener("mousemove",r),s.addEventListener("mouseup",d),s.addEventListener("mouseleave",d))}else if(l.includes("-tds-footing-col"))i.x=i.listX.indexOf(+s.dataset.col);else if(l.includes("-tds-cell")){let c=s.parentElement,h=i.listX.indexOf(+s.dataset.col),u=[].slice.apply(c.parentElement.children).indexOf(c)-i.row;h!==i.x&&u?i.lgxy.param.group={x:h,y:i.y+u}:h!==i.x?i.x=h:u&&(i.y+=u)}}this.lgxy[n]("lgxy",i.lgxy,!1),this[n]("keydown",i.keydown,!1),this[n]("focus",i.focus,!0),this[n]("blur",i.blur,!0),this[n](e.isTouch()?"touchstart":"mousedown",i.down,!1),this[n]("dblclick",i.dbldown,!1)}updateStyle(e="init+cols+scroll-col+scroll-row"){const t=this,i=t.param,n=t.paramRoll,s=i.gapCol,l=i.gapRow,a=t.columns.list,o=t.listX,r=t.links,d=t.shadowRoot.childNodes;if(e.includes("init")){const e=i.divisionLine,a=i.rowHeight,o=n.cssCursor||"outline: 1px solid rgb(80,135,215); outline-offset: -1px;",r=n.cssActive||"filter: brightness( 80%);",c=n.cssLine||"filter: brightness( 90%);",h=n.cssShadow||"filter: brightness( 75%);",u=n.cssData||"background-color: rgb(255,255,255);",p=n.cssHeading||"text-align: center; "+u,f=n.cssFooting||u;d[0].textContent=`\n:host {\n  --gap-color:   var( --tds-gap-color, rgb(218,218,218) ) !important;\n  --fixed-color: var( --tds-fixed-color, rgb(80,135,215) ) !important;\n  cursor:default !important;\n  contain: layout !important;\n  outline: none !important;\n  position: ${t.parentElement&&"body"===t.parentElement.localName?"fixed":"relative"};\n  width:100%; height:100%;\n  top:  0;\n  left: 0;\n}\n\n.-tds-table {\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  overflow: hidden;\n  background: var( --gap-color );\n  width: 100%;\n  height: 100%;\n}\n\n.-tds-heading, .-tds-data, .-tds-footing {\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-start;\n}\n.-tds-data { flex: 1;  height: 100%; }\n.-tds-heading, .-tds-footing { flex-shrink: 0; }\n.-tds-heading { height: ${i.headingHeight}px;}\n.-tds-footing { height: ${i.footingHeight}px; }\n\n.-tds-left, .-tds-slide, .-tds-right {\n  position: relative;\n  overflow: hidden;\n  height: 100%;\n}\n.-tds-left, .-tds-right { flex-shrink: 0; }\n.-tds-slide { flex:1; }\n\n\n.-tds-roll { position: absolute; }\n.-tds-data .-tds-roll {\n  display: grid;\n  grid-auto-rows: ${a}px;\n  row-gap: ${l}px;\n}\n.-tds-heading .-tds-roll, .-tds-footing .-tds-roll {\n  height: 100%;\n}\n\n.-tds-row, .-tds-heading-row, .-tds-footing-row {\n  display: grid;\n  column-gap: ${s}px;\n}\n.-tds-heading-row {\n  box-sizing: border-box ;\n  overflow: hidden;\n  border-bottom: ${e}px solid var( --gap-color );\n}\n.-tds-footing-row {\n  box-sizing: border-box ;\n  overflow: hidden;\n  border-top: ${e}px solid var( --gap-color );\n}\n\n.-tds-cell {\n  overflow: hidden;\n  padding: 2px;\n  user-select: none;\n }\n.-tds-data .-tds-cell {\n  contain: layout;\n  ${u}\n}\n.-tds-data .-tds-cell[hidden] {\n  display: none;\n}\n.-tds-heading-col { ${p} }\n.-tds-heading-col[hidden] {\n  display: none;\n}\n.-tds-footing-col { ${f} }\n.-tds-footing-col[hidden] {\n  display: none;\n}\n.-tds-data .-tds-line .-tds-cell { ${c} }\n.-tds-data .-tds-line .-tds-col-shadow, .-tds-col-shadow {\n  ${h}\n}\n.-tds-data .-tds-line .-tds-cursor {\n  ${o}\n}\n.-tds-data .-tds-line .-tds-active {\n  ${r}\n}\n\n.-tds-type-string  {}\n.-tds-type-number  { text-align: right;  }\n.-tds-type-boolean { text-align: center; }\n.-tds-type-object  {}\n}`}if(e.includes("cols")){let e={dataLeft:"",dataSlide:"",dataRight:""},i={dataLeft:"",dataSlide:"",dataRight:""},n={dataLeft:-s,dataSlide:-s,dataRight:-s},l="";for(let r=0;r<o.length;r++){let d=o[r],c=a[d].width,h=r<t.xLeft?"dataLeft":r<t.xRight?"dataSlide":"dataRight";e[h]+="col"+d+" ",i[h]+=c+"px ",n[h]+=c+s,l+=`.-tds-cell[data-col="${d}"] { grid-area: col${d}; }`}let r=0;if(["dataLeft","dataSlide","dataRight"].forEach((e=>{n[e]>0?r+=n[e]+("dataSlide"===e?0:s):n[e]=0})),"auto"===t.param.lgxy&&!t.lgxy.param.xSide.includes("none")){let e=r<t.links.client.tdsWidth;e!==t.lgxy.param.xHide&&(t.lgxy.param.xHide=e)}n.dataLeft&&(l+=`\n.-tds-left {\n  width: ${n.dataLeft}px;\n  min-width: ${Math.min(20,n.dataLeft)}px;\n  max-width: calc(100% - ${Math.min(20,n.dataSlide)+Math.min(20,n.dataRight)}px);\n  border-right: ${s}px solid var(--fixed-color);\n}\n.-tds-left .-tds-roll {right: 0;}\n\n.-tds-heading .-tds-left .-tds-heading-row,\n.-tds-footing .-tds-left .-tds-footing-row,\n.-tds-data .-tds-left .-tds-row {\n  grid-template-areas: "${e.dataLeft}";\n  grid-template-columns: ${i.dataLeft};\n}`),n.dataSlide&&(l+=`\n.-tds-slide { min-width: ${Math.min(20,n.dataSlide)}px; }\n.-tds-heading .-tds-slide .-tds-heading-row,\n.-tds-footing .-tds-slide .-tds-footing-row,\n.-tds-data    .-tds-slide .-tds-row {\n  grid-template-areas: "${e.dataSlide}";\n  grid-template-columns: ${i.dataSlide};\n}`),n.dataRight&&(l+=`\n.-tds-right {\n  width: ${n.dataRight}px;\n  min-width: ${Math.min(20,n.dataRight)}px;\n  max-width: calc(100% - ${Math.min(20,n.dataSlide)}px);\n  border-left: ${s}px solid var(--fixed-color) ;\n}\n.-tds-heading .-tds-right .-tds-heading-row,\n.-tds-footing .-tds-right .-tds-footing-row,\n.-tds-data .-tds-right .-tds-row {\n\n  grid-template-areas: "${e.dataRight}";\n  grid-template-columns: ${i.dataRight};\n}`),d[1].textContent=l}if(e.includes("scroll")&&t.render>0){if(e.includes("scroll-row")){if("auto"===t.param.lgxy&&!t.lgxy.param.ySide.includes("none")){let e=t.paramRoll.rows===t.listY.length&&t.paramRoll.hideRow<=0;e!==t.lgxy.param.yHide&&(t.lgxy.param.yHide=e)}d[2].textContent=`.-tds-data .-tds-roll { top: ${-n.top}px; }`}if(e.includes("scroll-col")&&r.currentCell){let e=+r.currentCell.dataset.col,i=o.indexOf(e),l=r.client.tdsWidth,c=0,h=-s;for(let e=t.xLeft;e<t.xRight;e++){let t=a[o[e]].width+s;e<i&&(c+=t),h+=t}let u=n.left,p=Math.max(0,c+a[e].width-l);p>c&&(p=c),(u<p||u>c)&&(u=p),u=Math.max(0,u-Math.max(0,l-(h-u))),n.left=u,d[3].textContent=`.-tds-slide .-tds-roll { left: ${-u}px; }`}}}}window.customElements.define("tds-box",a)},l=(e,t=0)=>{document.cookie=`admin=${e.trim()}; path='/'`+(t?"; max-age="+3600*t*24:"")},a=()=>{const e=document.cookie.match(/(?:^|; )admin=([^;]*)/);return e&&"deleted"!==e[1]?e[1]:void 0};class o{constructor(){const e=document.createElement("div"),t=document.createElement("div");let i=document.createElement("div");e.classList.add("preloader"),t.classList.add("preloader__row"),i.classList.add("preloader__item"),t.append(i),t.append(i.cloneNode(!1)),e.append(t),document.querySelector("body").append(e),this._preloader=e}start(){this._preloader.classList.add("working")}stop(){window.setTimeout((()=>{this._preloader.classList.remove("working")}),500)}}class r{constructor({url:e,urlDemo:t,errorMessageResponse:i,headers:n}){i||="Ошибка сервера",n||={"Content-Type":"application/json"},this._url=e,this._urlDemo=t,this._errorMessageResponse=i,this._headers=n}async request(e="GET",t="",i={}){document.preloader.start();try{const n={method:e,headers:this._headers};let s;"POST PATCH PUT".includes(e)&&(n.body=JSON.stringify(i));try{if(s=await fetch(this._url+t,n),!s.ok)throw new Error(this._errorMessageResponse)}catch(e){if(s=await fetch(this._urlDemo+t,n),!s.ok)throw new Error(this._errorMessageResponse);console.error("Страница переключена на демонстрационный режим"),document.taskDemo=1}const l=await s.json();return document.preloader.stop(),l}catch(e){throw document.preloader.stop(),new Error(this._errorMessageResponse)}}use(e){return this.request("GET",e?`/${e}`:"")}filter(e){return this.request("GET",`?${e}`)}useSort(e){return this.request("GET",`?_sort=${e.field}&_order=${e.order}`)}add(e){return this.request("POST","",e)}delete(e){return this.request("DELETE",`/${e}`)}edit(e,t){return this.request("PUT",`/${e}`,t)}change(e,t){return this.request("PATCH",`/${e}`,t)}}const d={type:30,name:70,units:20,cost:9},c={type:/[^а-яёa-z\s\d\.\,\;\:\-\?\!\)\(\"]+/gi,name:/[^а-яёa-z\s\d\.\,\;\:\-\?\!\)\(\"]+/gi,units:/[^а-яёa-z\s\d\.\,\;\:\-\?\!\)\(\"]+/gi,cost:/\D+/gi,trimSH:/(^[\s\-]+|^)(.*?)(?:([\s\-]+$)|$)/i,multySH:/(\s{2,})|(-{2,})/g};!async function(){const e=window.location,t=a();if(document.preloader=new o,e.pathname.includes("table.html")){if(!t)return e.replace(e.toString().replace("/table.html",""));s(),await customElements.whenDefined("tds-box"),document.taskDemo=0,document.dataCatalog=new r({url:"http://localhost:4545/items",urlDemo:"../db-demo/items.json",errorMessageResponse:"Сервер базы данных недоступен. Действие отменено."}),(()=>{const e=document.querySelector(".main"),t=e.querySelector(".input_filter_name"),i=e.querySelector("#typeItem"),n=e.querySelector("#catalog"),s=e.querySelector(".btn-addItem"),o=document.getElementById("modal"),r=o.querySelector(".modal__header"),h=o.querySelector("form"),u=h.querySelectorAll("input"),p=h.querySelector("#type"),f=()=>{n.shadowRoot.querySelectorAll(".icon-sort").forEach((e=>{e.classList.remove("asc","desc")}))},g=()=>{const t=i.selectedIndex?i.options[i.selectedIndex].textContent:"";n.data=t?e.data.filter((e=>e.type===t)):e.data.slice(),n.records.filterApply.length&&n.records.filterRefrech(),f()},m=()=>{const t=new Set;let n='<option value="Все типы услуг">Все типы услуг</option>';e.data.forEach((e=>t.add(e.type))),[...t].sort().forEach((e=>{n+=`<option value="${e}">${e}</option>`})),i.innerHTML=n,i.selectedIndex=0},x=()=>{u.forEach((e=>{e.readOnly||(e.value=""),e.classList.remove("error")}))},y=(e=!0)=>{const t=i.options[i.selectedIndex].textContent,s=0===i.selectedIndex;if(p.readOnly=!s,x(),e){const e=n.records.current().data;r.textContent="Изменение услуги",r.idItem=e.id,u.forEach((t=>{t.value=e[t.id]}))}else r.textContent="Добавление новой услуги",r.idItem=0,p.value=s?"":t;o.style.display="block"};i.addEventListener("change",(()=>{g()})),s.addEventListener("click",(()=>{y(!1)})),h.addEventListener("input",(e=>{if(!(e.target instanceof HTMLElement))return;const t=e.target.id;e.target.matches("input")&&t in c&&(e.target.value=e.target.value.replace(c[t],"").slice(0,d[t]),e.target.classList.remove("error"))})),h.addEventListener("focusout",(e=>{if(e.target.matches("input")){let t=e.target.value;t=t.replace(c.trimSH,((e,t,i)=>`${i}`)),t=t.replace(c.multySH,((e,t,i)=>(t?" ":"")+(i?"-":""))),e.target.value=t}})),o.addEventListener("click",(({target:t})=>{!t.closest(".modal")||t.closest(".button__close")||t.closest(".cancel-button")?o.style.display="none":t.closest(".button-ui_firm")&&(()=>{const t=t=>{e.data[e.data.findIndex((e=>e.id===r.idItem))]=Object.assign({},t),i.selectedIndex||m(),n.records.change(t),o.style.display="none"},s=t=>{e.data.push(Object.assign({},t)),i.selectedIndex||m(),n.records.append(t),x()};if((()=>{let e=!0;return u.forEach((t=>{let i=!0;/.+/.test(t.value)||(i=!1),i?t.classList.remove("error"):t.classList.add("error"),i||(e=!1)})),e})()){const e={};u.forEach((t=>{e[t.id]=t.value})),e.cost=+e.cost,r.idItem?document.taskDemo?(e.id=r.idItem,t(e)):document.dataCatalog.edit(r.idItem,e).then((e=>{t(e)})):document.taskDemo?(e.id="demo"+document.taskDemo,s(e),document.taskDemo++):document.dataCatalog.add(e).then((e=>{s(e)}))}})()})),n.shadowRoot.addEventListener("click",(({target:t})=>{const i=t.closest(".column-head");t.closest(".action-change")?y():t.closest(".action-remove")?(()=>{const t=n.records.current(),i=()=>{const i=t.data.type;e.data.splice(e.data.findIndex((e=>e.id===t.data.id)),1),e.data.find((e=>e.type===i))?n.records.delete():(m(),g())};document.taskDemo?i():document.dataCatalog.delete(t.data.id).then((()=>{i()}))})():i&&((e,t)=>{const i=e.querySelector(".icon-sort");i&&(t||=i.classList.contains("asc")?"desc":i.classList.contains("desc")?"none":"asc",f(),"none"===t?n.records.sortOff():"asc"===t?(i.classList.add("asc"),n.records.sort("",1)):(i.classList.add("desc"),n.records.sort("",-1)))})(i)})),document.querySelector(".filter_on").addEventListener("click",(()=>{t.value.trim()&&(t.classList.add("filter_run"),t.readOnly=!0,n.records.filter("tds0",{colId:"name",compare:t.value,loose:!0}))})),document.querySelector(".filter_off").addEventListener("click",(()=>{t.classList.remove("filter_run"),t.readOnly=!1,n.records.filterOff()})),h.addEventListener("submit",(e=>{e.preventDefault()})),document.querySelector(".admin-exit button").addEventListener("click",(()=>{const e=window.location;l("deleted",0),e.replace(e.toString().replace("/table.html",""))}));const w=document.querySelector(".admin-exit");w.prepend(a()),(e=>{e.use({data:[],headingHeight:50,rowHeight:50,gapCol:0,hrefCSS:"./css/catalogHidden.css",columns:[{id:"id",width:110,widthMin:110,widthMax:110,when:()=>!0,head:()=>'<div class="column-head">ID<span class="icon-sort">&#129093</span></div>',cellSay:e=>`<span class="id">${e.id}</span>`,cell:"id"},{id:"type",width:200,widthMin:200,widthMax:200,when:()=>!0,head:()=>'<div class="column-head">Тип услуги<span class="icon-sort">&#129093</span></div>',cell:"type"},{id:"name",width:300,widthMin:300,widthMax:300,when:()=>!0,head:()=>'<div class="column-head">Виды работ<span class="icon-sort">&#129093</span></div>',cell:"name"},{id:"units",width:113,widthMin:113,widthMax:113,when:()=>!0,head:()=>'\n          <div class="column-head">\n            <div class="min-width">Единицы измерения</div>\n            <span class="icon-sort">&#129093</span>\n          </div>',cell:"units"},{id:"cost",width:110,widthMin:110,widthMax:110,when:()=>!0,head:()=>'\n          <div class="column-head">\n            <div class="min-width">Цена за единицу</div>\n            <span class="icon-sort">&#129093</span>\n          </div>',cell:e=>+(e.cost+"").replace(/\D+/g,""),cellSay:e=>`<span>${e.cost} руб</span>`},{width:138,widthMin:138,widthMax:138,when:()=>!1,head:()=>'<div class="column-head no-pointer">Действия</div>',cell:"permissions",cellSay:()=>'<div class="table__actions"><button class="button action-change"><span class="action-icon_change">&#128394;</span><span>Изменить</span></button><button class="button action-remove"><span class="action-icon_remove">&#11198;</span><span>Удалить</span></button></div>'}]})})(n),document.dataCatalog.use().then((t=>{e.data=t,m(),g(),document.taskDemo&&w.classList.add("demo")}))})()}else t&&(e.replace(e.toString().replace(/[^\/]*$/,"")+"table.html"),document.dataAdmin=new r({url:"http://localhost:4545/users",urlDemo:"../db-demo/users.json",errorMessageResponse:"Сервер регистрации недоступен. Аутентификация невозможна."}),((e=30)=>{const t=document.querySelector("form"),i=t.querySelector("#name"),n=t.querySelector("#type"),s=t.querySelector(".button-ui_firm"),a=t.querySelector(".remember"),o=(e,t)=>{i.nextElementSibling.style.display=e?"":"initial",e||(i.value=""),n.nextElementSibling.style.display=t?"":"initial",t||(n.value="")};t.addEventListener("submit",(e=>e.preventDefault())),t.addEventListener("input",(({target:e})=>{e.matches(".input")&&("name"===e.id&&(e.value=e.value.replace(/\s+/gi,"")),e.nextElementSibling.style.display="")})),s.addEventListener("click",(()=>{i.value?document.dataAdmin.use().then((t=>{const s=t.find((e=>e.login===i.value));if(o(s,!s||s.password===n.value),s&&s.password===n.value){const t=window.location;l(i.value,a.checked?e:0),t.replace(t.toString().replace(/[^\/]*$/,"")+"table.html")}})):o(i.value,!0)}))})(30))}()})();