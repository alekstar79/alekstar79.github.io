var pict2pix;(()=>{"use strict";var t={d:(i,e)=>{for(var s in e)t.o(e,s)&&!t.o(i,s)&&Object.defineProperty(i,s,{enumerable:!0,get:e[s]})},o:(t,i)=>Object.prototype.hasOwnProperty.call(t,i),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},i={};t.r(i),t.d(i,{animate:()=>b,stop:()=>E});class e{static TWO_PI=2*Math.PI}class s{#t;#i;#e;#s;#a;#r;#h;#c;#n;#o;#l;#g;#f;#m;#d;constructor(t,i){this.#t=t,this.#i=0,this.#e=0,this.#s=i.x,this.#a=i.y,this.setFromOrigin(),this.setToOrigin(),this.#o=i.color,this.#d=i.ledSize/2}#p(){this.#l=this.#c-this.#r,this.#g=this.#n-this.#h}setTransitionTime(t){this.#f=t;const i=Math.floor(this.#f-this.#f/10),e=Math.floor(this.#f/2);this.#m=Math.floor(Math.random()*(i-e)+e)}setFrom(t,i){this.#r=t,this.#h=i,this.#p()}setTo(t,i){this.#c=t,this.#n=i,this.#p()}setFromPos(){this.#r=this.#i,this.#h=this.#e,this.#p()}setFromOrigin(){this.#r=this.#s,this.#h=this.#a,this.#p()}setToOrigin(){this.#c=this.#s,this.#n=this.#a,this.#p()}setPos(t,i){this.#i=t,this.#e=i}getX(){return this.#i}getY(){return this.#e}getOriginalX(){return this.#s}getOriginalY(){return this.#a}getTargetX(){return this.#c}getTargetY(){return this.#n}update(t){const i=t/this.#m;t<=this.#m?(this.#i=this.#l*i+this.#r,this.#e=this.#g*i+this.#h):(this.#i=this.#c,this.#e=this.#n)}draw(t){t.beginPath(),t.arc(this.#i,this.#e,this.#d,0,e.TWO_PI),t.closePath(),t.fillStyle=this.#o,t.fill()}}class a{config;constructor(t){this.config=t}update(t){}draw(t){}}class r extends a{constructor(t){super(t),this.x=Math.random()*this.config.maxWidth,this.y=Math.random()*this.config.maxHeight,this.speed=0,this.size=2*Math.random()+.2,this.color}update(t){this.y+=(3-this.speed)*t*.03*this.config.verticalSpeed,this.x+=(3-this.speed)*t*.03*this.config.horizontalSpeed,this.y>=this.config.maxHeight&&this.config.verticalSpeed>0&&(this.y=0,this.x=Math.random()*this.config.maxWidth),this.y<0&&this.config.verticalSpeed<0&&(this.y=this.config.maxHeight-1,this.x=Math.random()*this.config.maxWidth),this.x>=this.config.maxWidth&&this.config.horizontalSpeed>0&&(this.x=0,this.y=Math.random()*this.config.maxHeight),this.x<0&&this.config.horizontalSpeed<0&&(this.x=this.config.maxWidth-1,this.y=Math.random()*this.config.maxHeight);let i=Math.floor(this.y),e=Math.floor(this.x);i>=0&&i<this.config.maxHeight&&e>=0&&e<this.config.maxWidth&&(this.speed=this.config.mappedImage[i][e].brightness,this.color=this.config.mappedImage[i][e].color)}draw(t){t.beginPath(),t.globalAlpha=1,t.fillStyle=this.color,t.strokeStyle=this.color,t.arc(this.x,this.y,this.size,0,e.TWO_PI),t.fill()}}class h extends r{#u=0;constructor(t){super(t)}update(t){super.update(t),this.#u+=this.speed/20,this.y+=Math.sin(this.#u),this.x+=Math.cos(this.#u)}}class c{#t;#o;#i;#e;#s;#a;#c;#n;#r;#h;#l;#g;constructor(t,i){this.#t=t,this.#o=i.color,this.#s=i.x,this.#a=i.y,this.setFromOrigin(),this.setToOrigin()}#p(){this.#l=this.#c-this.#r,this.#g=this.#n-this.#h}setFrom(t,i){this.#r=t,this.#h=i,this.#p()}setTo(t,i){this.#c=t,this.#n=i,this.#p()}setFromOrigin(){this.#r=this.#s,this.#h=this.#a,this.#p()}setToOrigin(){this.#c=this.#s,this.#n=this.#a,this.#p()}setPosOrigin(){this.#i=this.#s,this.#e=this.#a}setPos(t,i){this.#i=t,this.#e=i}getX(){return this.#i}getY(){return this.#e}getFromX(){return this.#r}getFromY(){return this.#h}getDx(){return this.#l}getDy(){return this.#g}getOriginalX(){return this.#s}getOriginalY(){return this.#a}draw(t){this.#i<this.#t.maxWidth&&this.#e<this.#t.maxHeight&&(t.beginPath(),t.arc(this.#i,this.#e,this.getRadio(this.#i,this.#e),0,e.TWO_PI),t.closePath(),t.fillStyle=this.#o,t.fill())}getRadio(t,i){const e=Math.floor((t-this.#t.dotSize/2)/this.#t.dotSize),s=Math.floor((i-this.#t.dotSize/2)/this.#t.dotSize);if(s<this.#t.mappedImage.length&&e<this.#t.mappedImage[0].length){const t=this.#t.mappedImage[s][e].brightness;return this.#t.dotSize*(2.55-t)/4}return 0}}class n{static#y={"straight-particle":t=>new r(t),"twisted-particle":t=>new h(t),"led-matrix":(t,i)=>new s(t,i),halftone:(t,i)=>new c(t,i)};static createParticle(t,i){return this.#y[t.particleType]?.(t,i)??new r}}function o(t,i,e){let s=[];for(let a=0;a<e;a++){const e=4*a*t.width;let r=[];for(let s=0;s<i;s++){const i=4*s,a=t.data[e+i],h=t.data[e+(i+1)],c=t.data[e+(i+2)],n=t.data[e+(i+3)],o={brightness:l(a,h,c),alpha:n,color:"rgb("+a+","+h+","+c+")"};r.push(o)}s.push(r)}return s}function l(t,i,e){return Math.sqrt(t*t*.299+i*i*.587+e*e*.114)/100}function g(t,i){const e=document.createElement("canvas"),s=t.width/i,a=t.height/i;e.width=s,e.height=a;const r=e.getContext("2d");return r.drawImage(t,0,0,s,a),r.getImageData(0,0,s,a)}class f{#t;#x=[];constructor(t){this.#t=t;let i=document.createElement("canvas");i.width=this.#t.image.width,i.height=this.#t.image.height;let e=i.getContext("2d");e.drawImage(this.#t.image,0,0,this.#t.image.width,this.#t.image.height);const s=e.getImageData(0,0,this.#t.image.width,this.#t.image.height);this.#t.numberOfParticles=this.#t.numberOfParticles||3e3,this.#t.maxWidth=this.#t.image.width,this.#t.maxHeight=this.#t.image.height,this.#t.mappedImage=o(s,this.#t.maxWidth,this.#t.maxHeight),this.#t.verticalSpeed=t.verticalSpeed??1,this.#t.horizontalSpeed=t.horizontalSpeed??1;for(let i=0;i<this.#t.numberOfParticles;i++)this.#x.push(n.createParticle(t))}update(t){for(let i=0;i<this.#x.length;i++)this.#x[i].update(t)}draw(t){t.globalAlpha=.01,t.fillStyle="rgb(0, 0, 0)",t.fillRect(0,0,this.#t.maxWidth,this.#t.maxHeight);for(let i=0;i<this.#x.length;i++)this.#x[i].draw(t)}}class m{ledMatrixEffect;setLedMatrixEffect(t){this.ledMatrixEffect=t}update(t){}}class d extends m{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;const e=Math.random()*this.#t.maxWidth,s=Math.random()*this.#t.maxHeight;for(let t=0;t<this.#x.length;t++)this.#x[t].setTransitionTime(this.#t.transitionTime),this.#x[t].setFromPos(),this.#x[t].setTo(e,s)}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime)this.ledMatrixEffect.setState(T.createLedMatrixState("returning",this.#t,this.#x));else for(let t=0;t<this.#x.length;t++)this.#x[t].update(this.#T,this.#t.transitionTime)}}class p extends m{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;const e=-1*this.#t.ledSize/2;for(let t=0;t<this.#x.length;t++)this.#x[t].setTransitionTime(this.#t.transitionTime),this.#x[t].setFromPos(),this.#x[t].setTo(this.#x[t].getOriginalX(),e)}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime){for(let t=0;t<this.#x.length;t++)this.#x[t].setPos(this.#x[t].getOriginalX(),this.#t.maxHeight-1);this.ledMatrixEffect.setState(T.createLedMatrixState("returning",this.#t,this.#x))}else for(let t=0;t<this.#x.length;t++)this.#x[t].update(this.#T,this.#t.transitionTime)}}class u extends m{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;const e=-1*this.#t.ledSize/2;for(let t=0;t<this.#x.length;t++)this.#x[t].setTransitionTime(this.#t.transitionTime),this.#x[t].setFromPos(),this.#x[t].setTo(e,this.#x[t].getOriginalY())}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime){for(let t=0;t<this.#x.length;t++)this.#x[t].setPos(this.#t.maxWidth-1,this.#x[t].getOriginalY());this.ledMatrixEffect.setState(T.createLedMatrixState("returning",this.#t,this.#x))}else for(let t=0;t<this.#x.length;t++)this.#x[t].update(this.#T,this.#t.transitionTime)}}class y extends m{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;for(let t=0;t<this.#x.length;t++)this.#x[t].setTransitionTime(this.#t.transitionTime),this.#x[t].setFromPos(),this.#x[t].setToOrigin()}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime)this.ledMatrixEffect.setState(T.createLedMatrixState("idle",this.#t,this.#x));else for(let t=0;t<this.#x.length;t++)this.#x[t].update(this.#T,this.#t.transitionTime)}}class x extends m{#T=0;#t;#x;constructor(t,i){super(),this.#t=t,this.#x=i}update(t){this.#T+=t,this.#T>this.#t.idleTime&&this.ledMatrixEffect.setState(T.createLedMatrixState(this.#t.type,this.#t,this.#x))}}class T{static#A={point:(t,i)=>new d(t,i),horizontal:(t,i)=>new p(t,i),vertical:(t,i)=>new u(t,i),returning:(t,i)=>new y(t,i),idle:(t,i)=>new x(t,i)};static createLedMatrixState(t,i,e){let s;return s="random"===t?T.getRandomState():t,T.#A[s]?.(i,e)??new d(i,e)}static getRandomState(){const t=Math.floor(3*Math.random());return Object.keys(T.#A)[t]}}class A{#t;#x=[];#S;constructor(t){this.#t=t,this.#t.maxWidth=this.#t.image.width,this.#t.maxHeight=this.#t.image.height,this.#t.transitionTime=t.transitionTime??2e3,this.#t.idleTime=t.idleTime??5e3,this.#t.ledSize=t.ledSize&&t.ledSize>=4?t.ledSize:4;const i=g(this.#t.image,this.#t.ledSize),e=o(i,i.width,i.height);this.createParticlesFromMappedImage(e,i.width,i.height),this.setState(T.createLedMatrixState("returning",this.#t,this.#x))}setState(t){this.#S=t,this.#S.setLedMatrixEffect(this)}createParticlesFromMappedImage(t){const i=this.#t.ledSize/2;for(var e=0;e<t.length;e++)for(var s=0;s<t[e].length;s++)if(t[e][s].alpha>128){let a=t[e][s].color,r=n.createParticle(this.#t,{x:s*this.#t.ledSize+i,y:e*this.#t.ledSize+i,color:a,ledSize:this.#t.ledSize});this.#x.push(r)}}update(t){this.#S.update(t)}draw(t){t.clearRect(0,0,this.#t.maxWidth,this.#t.maxHeight);for(let i=0;i<this.#x.length;i++)this.#x[i].draw(t)}}class S{halftoneEffect;setHalftoneEffect(t){this.halftoneEffect=t}update(t){}}class w extends S{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;for(let t=0;t<this.#x.length;t++)this.#x[t].setFrom(this.#x[t].getOriginalX()*this.#t.separation,this.#x[t].getOriginalY()*this.#t.separation),this.#x[t].setToOrigin()}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime)this.halftoneEffect.setState(Y.createHalftoneEffectState("idle",this.#t,this.#x));else for(let t=0;t<this.#x.length;t++){const i=this.#T/this.#t.transitionTime-1,e=this.#x[t].getDx()*Math.sqrt(1-i*i*i*i)+this.#x[t].getFromX(),s=this.#x[t].getDy()*Math.sqrt(1-i*i*i*i)+this.#x[t].getFromY();this.#x[t].setPos(e,s)}}}class M extends S{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i}update(t){this.#T+=t,this.#T>this.#t.idleTime&&this.halftoneEffect.setState(Y.createHalftoneEffectState("returning",this.#t,this.#x))}}class X extends S{#t;#x;#T=0;constructor(t,i){super(),this.#t=t,this.#x=i;for(let t=0;t<this.#x.length;t++)this.#x[t].setFromOrigin(),this.#x[t].setTo(this.#x[t].getOriginalX()*this.#t.separation,this.#x[t].getOriginalY()*this.#t.separation)}update(t){if(this.#T+=t,this.#T>this.#t.transitionTime)this.halftoneEffect.setState(Y.createHalftoneEffectState("going",this.#t,this.#x));else for(let t=0;t<this.#x.length;t++){const i=this.#T/this.#t.transitionTime,e=-this.#x[t].getDx()*(Math.sqrt(1-i*i)-1)+this.#x[t].getFromX(),s=-this.#x[t].getDy()*(Math.sqrt(1-i*i)-1)+this.#x[t].getFromY();this.#x[t].setPos(e,s)}}}class Y{static#A={going:(t,i)=>new w(t,i),idle:(t,i)=>new M(t,i),returning:(t,i)=>new X(t,i)};static createHalftoneEffectState(t,i,e){return Y.#A[t]?.(i,e)??new HalftoneEffectGoingPointState(i,e)}}class P{#t;#x=[];#S;constructor(t){this.#t=t,this.#t.maxWidth=this.#t.image.width,this.#t.maxHeight=this.#t.image.height,this.#t.dotSize=t.dotSize&&t.dotSize>=4?t.dotSize:4,this.#t.transitionTime=t.transitionTime??8e3,this.#t.idleTime=t.idleTime??4e3,this.#t.color=t.color??"rgb(30, 30, 30)",this.#t.separation=t.separation&&t.separation>=1?t.separation:10;const i=g(this.#t.image,this.#t.dotSize);this.#t.mappedImage=o(i,i.width,i.height),this.createParticlesFromMappedImage(),this.setState(Y.createHalftoneEffectState("going",this.#t,this.#x))}setState(t){this.#S=t,this.#S.setHalftoneEffect(this)}createParticlesFromMappedImage(){const t=this.#t.dotSize/2;for(var i=0;i<this.#t.mappedImage.length;i++)for(var e=0;e<this.#t.mappedImage[i].length;e++)if(this.#t.mappedImage[i][e].alpha>128){let s=n.createParticle(this.#t,{x:e*this.#t.dotSize+t,y:i*this.#t.dotSize+t,color:this.#t.color,size:this.#t.dotSize*(2.55-this.#t.mappedImage[i][e].brightness)/2});this.#x.push(s)}}update(t){this.#S.update(t)}draw(t){t.clearRect(0,0,this.#t.maxWidth,this.#t.maxHeight);for(let i=0;i<this.#x.length;i++)this.#x[i].draw(t)}}class O{static#w={"straight-particle":t=>new f(t),"twisted-particle":t=>new f(t),"led-matrix":t=>new A(t),halftone:t=>new P(t)};static createParticle(t){return this.#w[t.particleType]?.(t)??new f(t)}}class z{#M;#X;#Y;#P=0;#O=0;#z;#t;running=!1;constructor(t){this.#t=t,this.#M=document.createElement("canvas"),this.#M.width=this.#t.image.width||this.#t.image.naturalWidth,this.#M.height=this.#t.image.height||this.#t.image.naturalHeight,this.#X=this.#M.getContext("2d"),this.#z=O.createParticle(t)}update(t){this.#z.update(t)}draw(){this.#z.draw(this.#X)}start(){this.running||(this.#P=0,this.#t.image.style.display="none",this.#t.image.parentNode.insertBefore(this.#M,this.#t.image),this.#Y=requestAnimationFrame(this.loop.bind(this)),this.running=!0)}stop(){this.running&&(this.#t.image.style.display="initial",this.#t.image.parentNode.removeChild(this.#M),window.cancelAnimationFrame(this.#Y),this.running=!1)}loop(t){this.#P||(this.#P=t),this.#O=t-this.#P,this.#P=t,this.update(this.#O),this.draw(),this.#Y=requestAnimationFrame(this.loop.bind(this))}}var v={};function b(t){v[t.image.id]||(v[t.image.id]={pict2pix:new z(t),running:!0}),v[t.image.id].running=!0,v[t.image.id].pict2pix.start()}function E(t){v[t].running=!1,v[t].pict2pix.stop()}document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState?function(){for(var t in v)v[t].running&&v[t].pict2pix.stop()}():function(){for(var t in v)v[t].running&&v[t].pict2pix.start()}()}),!1),pict2pix=i})();