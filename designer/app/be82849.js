(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{351:function(t,e,n){"use strict";n.r(e),n.d(e,"createTool",(function(){return h}));var i=n(2),r=n(33),s=n(1),o=n(0),a=n.n(o);n(3),n(14),n(15),n(88),n(94),n(27),n(83),n(12),n(16),n(18),n(25),n(9),n(26);function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){Object(i.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function h(t){return l.apply(this,arguments)}function l(){return(l=Object(s.a)(a.a.mark((function t(e){var i,o,c,h,l,f,d,p;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return d=function(t){["origin","blank","dump","src","id"].forEach((function(e){t[e]=null}))},i=e.fabric,t.next=4,n.e(9).then(n.bind(null,168));case 4:return o=t.sent,c=o.createCanvas,t.next=8,Promise.resolve().then(n.bind(null,106));case 8:return h=t.sent,l=h.createImage,f=2*Math.PI,p=i.util.createClass(i.BaseBrush,{type:"EraserBrush",context:null,alpha:20,soft:0,origin:null,blank:null,dump:null,src:null,id:null,initialize:function(t){var e=this;t.on("before:render",(function(){return e.blank&&e._restoreTopContext()})),this.canvas=t,this._points=[]},alphaSoftApproximate:function(){var t=this.alpha/255,e=this.width/2,n=this.soft;return{a0:n>0?t*n:t,a1:t,w:e,k:1+n/2}},dot:function(t,e,n){var i=e.x,r=e.y,s=n.a0,o=n.a1,a=n.w,c=n.k,u=t.createRadialGradient(i,r,1,i,r,a*o);u.addColorStop(0,"rgba(255,255,255,".concat(s,")")),u.addColorStop(1,"rgba(255,255,255,".concat(o,")")),t.fillStyle=u,t.beginPath(),t.arc(i,r,a*c,0,f),t.closePath(),t.fill()},_render:function(t){var e,n,i=this.alphaSoftApproximate(),s="source-over",o=this._points[0],a=this._points[1],c=i.w/i.k;if(2===this._points.length&&o.x===a.x&&o.y===a.y){var u=i.w/1e3;o.x-=u,a.x+=u}t||(t=this.canvas.contextTop,s="destination-out"),t.save(),t.globalCompositeOperation=s;for(var h=1;h<this._points.length;h++){if((n=o.distanceFrom(a))>c){var l;e=[];for(var f=Math.ceil(n/c);f>0;--f)e.push(o.lerp(a,1/f));(l=this._points).splice.apply(l,[h,0].concat(Object(r.a)(e))),a=e[0]}this.dot(t,o.midPointFrom(a),i),o=this._points[h],a=this._points[h+1]}t.restore()},_addPoint:function(t){var e=this._points||[];return!(e.length>1&&t.eq(e[e.length-1]))&&(this._points.push(t),!0)},_prepareForDrawing:function(t,e){var n=e.x,r=e.y,s=new i.Point(n,r);this._points=[],this._addPoint(s),t.moveTo(s.x,s.y)},_captureDrawingPath:function(t){var e=t.x,n=t.y;return this._addPoint(new i.Point(e,n))},_restoreTopContext:function(){this.drawImage(this.canvas.contextTop),this.drawBlank(this.canvas.contextTop)},onMouseDown:function(t,e){var n=e.e;if(this.canvas._isMainEvent(n)){var i=this.canvas.contextTop;this._prepareForDrawing(i,t),this._captureDrawingPath(t),this._restoreTopContext(),this._render()}},onMouseMove:function(t,e){var n=e.e;this.canvas._isMainEvent(n)&&this._captureDrawingPath(t)&&this._points.length>1&&(this._restoreTopContext(),this._render())},onMouseUp:function(t){var e=t.e;return!this.canvas._isMainEvent(e)||(this.toBlank(),!1)},toBlank:function(){this._render(this.blank.getContext("2d"))},drawBlank:function(t){t.save(),t.globalCompositeOperation="destination-out",t.drawImage(this.blank,0,0),t.restore()},drawImage:function(t){var e=this.src,n=this.dump,i=n.left,r=n.top,s=this.canvas,o=s.width,a=s.height,c=s.viewportTransform;t.clearRect(0,0,o,a),t.setTransform(c[0],c[1],c[2],c[3],c[4],c[5]),t.drawImage(e,i,r)},newBlank:function(){this.blank=c(this.canvas)},setTargetObject:function(t){var e=this;return Object(s.a)(a.a.mark((function n(){var i;return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("image"===t.type){n.next=6;break}return n.next=3,l(t);case 3:n.t0=n.sent,n.next=7;break;case 6:n.t0=t;case 7:i=n.t0,e.dump=i.getBoundingRect(!0),e.src=i.toCanvasElement(),e.id=e.getId(t),e.origin=i,e.drawImage(e.canvas.contextTop),e.newBlank(),e.canvas.remove(t),e.canvas.renderAll();case 16:case"end":return n.stop()}}),n)})))()},setContext:function(t){this.context=t},finalize:function(){this.context.$emit("drawingtool:end"),this._points=[],d(this)},getId:function(t){return this.canvas.getObjects().findIndex((function(e){return e===t}))},apply:function(){var t=this;return new Promise((function(e){var n,r,s=u(u({},t.origin.toObject()),{},{visible:!0}),o=u(u({},s),{},{scaleX:1,scaleY:1,angle:0}),a=s.width,c=s.height,h=s.angle,l=s.scaleX,f=s.scaleY,d=t.dump,p=d.width,g=d.height,b=d.left,m=d.top,v=Math.PI/180,y=p/l,w=g/f,x=-y/2,k=-w/2;i.Image.fromObject(o,(function(o){n=o.toCanvasElement(),(r=n.getContext("2d")).save(),r.translate(a/2,c/2),r.rotate(-h*v),r.globalCompositeOperation="destination-out",r.drawImage(t.blank,b,m,p,g,x,k,y,w),r.restore(),s.src=n.toDataURL("image/png",1),i.Image.fromObject(s,e)}))}))},perform:function(t,e){var n=this;"function"!=typeof e&&(e=function(){}),(t?this.apply():Promise.resolve(this.origin)).then((function(t){var i;t&&(i=t,n.canvas.insertAt(i,n.id)),e()})).catch((function(){e(),n.context.$bus.$emit("snack",{content:"graph.unexpected_error",color:"error"})})).finally((function(){n.canvas.requestRenderAll(),n.finalize()}))}}),i.eraserTool=function(t){var e=new p(t.canvas);return e.setContext(t),e},t.abrupt("return",i);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},356:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"injectFunctionality",(function(){return g}));n(16),n(25),n(26);var i=n(178),r=n(33),s=n(69),o=n(20),a=n(2),c=n(1),u=n(0),h=n.n(u),l=(n(3),n(14),n(15),n(264),n(141),n(58),n(43),n(57),n(24),n(258),n(140),n(53),n(75),n(12),n(29),n(32),n(101),n(18),n(27),n(9),n(183),n(51),n(34),n(398),["objects"]),f=["objects"];function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?d(Object(n),!0).forEach((function(e){Object(a.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t){return b.apply(this,arguments)}function b(){return b=Object(c.a)(h.a.mark((function e(u){var d,g,b,m,v,y,w,x,k,j,O,_,S,C,P,T,F,D,z,R,A,U,E,M,I,W,B,Y,q,X,L,J,N,$,H,G,V,K,Q,Z,tt,et,nt,it,rt,st,ot,at,ct,ut,ht,lt,ft,dt,pt,gt,bt,mt,vt,yt,wt,xt,kt,jt,Ot,_t,St,Ct,Pt,Tt,Ft,Dt,zt,Rt,At,Ut,Et,Mt,It,Wt,Bt,Yt,qt,Xt,Lt,Jt,Nt,$t,Ht,Gt,Vt,Kt;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Kt=function(t){var e=this;if(!this.target&&!this.rest.length){var n,i,r,s,o,a,c,u=void 0!==t;t||(t=this.point||v("+6 day 23 hour 59 minute",null)),a=!(c=Vt((new Date).getTime()/1e3,t,u)),o=this._objects.filter((function(t){return"count"===t.type})),c||(c={day:0,hour:0,minute:0}),u&&!a||!o.length?(n=Object.keys(c),i=this.left+75,r=this.top-25,n.length||(n=["day","hour","minute"]),this._restoreObjectsState(),d.util.resetObjectTransform(this),s=this._objects.filter((function(t){return"count"===t.type})),this._objects=this._objects.filter((function(t){return"count"!==t.type})),n.forEach((function(t,n){var o=s.find((function(e){return e.interval===t})),a=Ot(c[t]||0);o&&(i=o.left,r=o.top),e._objects.push(new d.Count(a,{fontFamily:e.fontFamily,fontSize:e.fontSize,fill:e.textFill,canvas:e.canvas,group:e,left:i,top:r,interval:t})),i+=70*n})),this._calcBounds(),this._updateObjectsCoords(),this.setCoords()):o.forEach((function(t){return t.set("text",Ot(c[t.interval]||0))})),this.point=t,this.dirty=!0}},Vt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t>=e)return!1;var i,r={year:0,month:0,day:0,hour:0,minute:0};return Object.keys(r).forEach((function(s){for(;e>=(i=v("+1 ".concat(s),t));)++r[s],t=i;n&&!r[s]?(delete r[s],n=!0):n=!1})),r},Gt=function(t){if(this.callSuper("initDimensions"),"widget-weather"===(this.group||{}).type){t&&(this.dims=t),t||(t=this.dims),this.mtxt=t?this.smtl[Pt(t,"temp")]:this.mtxt||this.smtl.temp;var e=this.getContext().measureText(this.mtxt).width;e!==this.width&&(this.width=e)}},Ht=function(t,e){(this.target||this.rest.length)&&this._modify({suppress:!0});var n=t.slice(7).toLowerCase();if(this._objects.find((function(t){return t.label===n})).visible=e,!["redo","undo"].includes(this.stateAction))return this.widgetUpdate()},$t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.scale,i=void 0!==n&&n,r=e.move,s=void 0!==r&&r;i&&t.on("scaling",L),s&&t.on("moving",X),t.customiseControls(bt),t.customiseCornerIcons(mt)},Nt=function(t){switch(t.type){case"widget-weather":return"weather-item";case"widget-countdown":return"count";case"widget-rss":return"rss-item"}return"text"},Jt=function(t){return function(e){try{return!!this.shadow||t.call(this,e)}catch(n){}}},Lt=function(){return function(){return this.custom||(this.custom={unique:"",name:""}),this.custom.unique=k(12),this}},Xt=function(){return function(t){return this.custom||(this.custom={unique:k(12),name:""}),this.custom.name=t,this}},qt=function(t){return function(e){var n=this.custom||{unique:k(12),name:""};return d.util.object.extend(t.call(this,e),{custom:Object.keys(n).reduce((function(t,e){return p(p({},t),{},Object(a.a)({},e,n[e]))}),{})})}},Yt=function(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.grid||e.custom||(e.custom={unique:k(12),name:""}),delete e.grid,"function"==typeof t&&t.call(this,e)}},Bt=function(){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.canvas?this.canvas.contextContainer:ut;return e.font=Wt(Object.assign({},this,t)),e}},Wt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fontWeight,n=void 0===e?400:e,i=t.fontStyle,r=void 0===i?"normal":i,s=t.fontSize,o=void 0===s?20:s,a=t.fontFamily,c=void 0===a?"sans-serif":a,u="undefined"==typeof window;return[u?n:r,u?r:n,o+"px",u?'"'+c+'"':c].join(" ")},It=function(t){return"string"==typeof t?W.decode(t.replace(/(<([^>]+)>)/gim,"").replace(/(\r\n|\n|\r|\s)+/gim," ").trim()):""},Mt=function(t){return at.search=new URLSearchParams({v:9,lang:"ru_RU",search_type:"tune",ll:"37.622505,55.753216",spn:"0.5,0.5",n:20,part:t,callback:C}).toString(),S(at.toString())},Et=function(t){return fetch("https://alekstar79.github.io/designer/api/".concat(t)).then((function(t){return t.json()}))},Ut=function(t,e){return ct.search=new URLSearchParams({src:t,charset:e}).toString(),fetch(ct).then((function(t){return t.json()}))},At=function(t,e){return w(new Date,"DD MM YYYY",ot(e))},Rt=function(t,e,n){var i=new Date;return w(new Date(i.getTime()+60*(i.getTimezoneOffset()+n)*1e3),"shortTime",ot(e))},zt=function(){return zt=Object(c.a)(h.a.mark((function t(){var e,n=arguments;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=n.length>0&&void 0!==n[0]?n[0]:10;case 1:return t.next=3,new Promise((function(t){return setTimeout(t,100)}));case 3:if(--e&&!(wt||[]).length){t.next=1;break}case 4:case"end":return t.stop()}}),t)}))),zt.apply(this,arguments)},Dt=function(){return zt.apply(this,arguments)},Ft=function(){return Ft=Object(c.a)(h.a.mark((function t(){var e,n=arguments;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=n.length>0&&void 0!==n[0]?n[0]:10;case 1:return t.next=3,new Promise((function(t){return setTimeout(t,100)}));case 3:if(--e&&!Object.keys(yt).length){t.next=1;break}case 4:case"end":return t.stop()}}),t)}))),Ft.apply(this,arguments)},Tt=function(){return Ft.apply(this,arguments)},Pt=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"temp";return gt.some((function(n){return e.includes(n)&&(t=n),!!t})),t||n},Ct=function(t,e){var n=1;if(t===e)return n;switch(!0){case"RUB"===e&&t in yt:n=St(yt[t].value/yt[t].nominal);break;case"RUB"===t&&e in yt:n=St(yt[e].nominal/yt[e].value);break;case t in yt&&e in yt:n=St(_t(yt[t])/_t(yt[e]))}return n},St=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-2;return t=+t,e=+e,isNaN(t)?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e)))},_t=function(t){return t.value/t.nominal},Ot=function(t){return(t<10?"0":"")+t},jt=function(t,e,n){return t[e][n.split(".")[1]]},kt=function(){},d=u.fabric,b=(g=void 0===t||!0)?"./index.mjs":"./empty.mjs",e.next=35,n.e(324).then(n.t.bind(null,1059,7));case 35:return m=e.sent,v=m.default,e.next=39,n.e(251).then(n.t.bind(null,1060,7)).then((function(t){return t.default}));case 39:return y=e.sent,w=y.format,e.next=43,Promise.resolve().then(n.bind(null,255));case 43:return x=e.sent,k=x.rndstring,e.next=47,Promise.resolve().then(n.bind(null,158));case 47:return j=e.sent,O=j.debounce,e.next=51,n.e(329).then(n.bind(null,1061));case 51:return _=e.sent,S=_.jsonp,C=_.callback,e.next=56,n.e(327).then(n.bind(null,1051));case 56:return P=e.sent,T=P.createRenderingContext,e.next=60,n.e(16).then(n.bind(null,163));case 60:return F=e.sent,D=F.blank,z=F.down,R=F.remove,A=F.rotate,U=F.up,e.next=68,n.e(16).then(n.bind(null,1054));case 68:return E=e.sent,M=E.default,e.next=72,n.e(326).then(n.bind(null,1062));case 72:return I=e.sent,W=I.default,e.next=76,Promise.resolve().then(n.bind(null,456));case 76:return B=e.sent,Y=B.Lorem,e.next=80,n.e(15).then(n.bind(null,401));case 80:return q=e.sent,X=q.preventMove,L=q.preventScale,e.next=85,n(431)("".concat(b)).then((function(t){return t.default||t}));case 85:return J=e.sent,N=J.setControls,e.next=89,n.e(36).then(n.bind(null,516));case 89:return $=e.sent,H=$.shapeAddFunctionality,e.next=93,n.e(34).then(n.bind(null,514));case 93:return G=e.sent,V=G.frameAddFunctionality,e.next=97,n.e(38).then(n.bind(null,518));case 97:return K=e.sent,Q=K.textAddFunctionality,e.next=101,n.e(35).then(n.bind(null,515));case 101:return Z=e.sent,tt=Z.imgAddFunctionality,e.next=105,n.e(37).then(n.bind(null,517));case 105:return et=e.sent,nt=et.svgAddFunctionality,e.next=109,n.e(39).then(n.bind(null,498));case 109:return it=e.sent,rt=it.splitText,e.next=113,n.e(33).then(n.bind(null,512));case 113:return st=e.sent,ot=st.i18nSettings,at=new URL("https://suggest-maps.yandex.ru/suggest-geo"),ct=new URL("https://alekstar79.github.io/designer/api/get/channel"),ut=T(1590,530),ht={pressure:"Давление: 760 мм рт.ст.",humidity:"Влажность: 80%",temp:"17 °C",cond:"Облачно с прояснениями",wind:"Ветер: 2.3 м/с, северо-восточный"},lt={subscribers:3907,online:112,male:2581,female:1326},ft={en:{subscribers:"Subscribers",online:"Online",male:"Male",female:"Female"},ru:{subscribers:"Подписчики",online:"Онлайн",male:"Муж",female:"Жен"}},dt=["subTargetCheck","hasRotatingPoint","lockScalingFlip","lockSkewingX","lockSkewingY","ungrouped","textAlign","textFill","textWidth","fontFamily","fontSize","top","left","width","height","rounded","track","profile","userId","user","info","feed","channel","charset","timezone","city","icon","point","marks","label","visibleTitle","visibleContent","visibleDate","charsCount","sid","code","curr","rate","short"],gt=["wind","pressure","himidity","cond","temp"],"resize",null,bt=p(p({},(pt=["bl","br","tl","tr","ml","mb","mr","mt"]).reduce((function(t,e){return p(p({},t),{},Object(a.a)({},e,{cursor:"resize",action:null}))}),{})),{},{mtr:{cursor:null,action:null}}),mt=p(p({},pt.reduce((function(t,e){return p(p({},t),{},Object(a.a)({},e,{icon:D}))}),{})),{},{mtr:{icon:D},settings:{borderColor:"#0094dd",cornerBackgroundColor:"#0094dd",cornerShape:"rect",cornerSize:10}}),vt=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return p(p({},t),{},{track:{left:0,top:0,width:0,height:0,scaleX:1,scaleY:1},hasRotatingPoint:!0,lockScalingFlip:!1,lockSkewingX:!1,lockSkewingY:!1})},yt={},d.RssItem=d.util.createClass(d.Text,{type:"rss-item",prevent:!0,lockUniScaling:!1,lockScalingX:!1,lockScalingY:!1,textAlign:"left",originX:"left",originY:"top",originalString:"",maxWidth:400,chars:200,toObject:function(){return this.callSuper("toObject",["originalString","label","chars","maxWidth"])},_set:function(){for(var t,e,n=this.maxWidth,i=arguments.length,r=new Array(i),s=0;s<i;s++)r[s]=arguments[s];switch(r[0]){case"canvas":(e=r[1].contextContainer)&&(t=this.text.replace(/(\r\n|\n|\r|\s)+/gim," "),e.font=Wt(this),t.length<this.chars&&(t=this.originalString),t.length>this.chars&&(t=t.substring(0,this.chars-1)+"…"),this.text=rt(e,t,n).filter((function(t){return""!==t})).join("\n"));break;case"text":(t=r[1])&&(t=t.replace(/(\r\n|\n|\r|\s)+/gim," "),e=this.getContext(),t.length<this.chars&&(t=this.originalString),t.length>this.chars&&(t=t.substring(0,this.chars-1)+"…"),r[1]=rt(e,t,n).filter((function(t){return""!==t})).join("\n"));break;case"maxWidth":t=this.text.replace(/(\r\n|\n|\r|\s)+/gim," "),e=this.getContext(),this.text=rt(e,t,r[1]).filter((function(t){return""!==t})).join("\n");break;case"fontFamily":t=this.text.replace(/(\r\n|\n|\r|\s)+/gim," "),e=this.getContext({fontFamily:r[1]}),this.text=rt(e,t,n).filter((function(t){return""!==t})).join("\n");break;case"fontSize":t=this.text.replace(/(\r\n|\n|\r|\s)+/gim," "),e=this.getContext({fontSize:r[1]}),this.text=rt(e,t,n).filter((function(t){return""!==t})).join("\n");break;case"chars":t=this.text.replace(/(\r\n|\n|\r|\s)+/gim," "),e=this.getContext(),t.length<r[1]&&(t=this.originalString),t.length>r[1]&&(t=t.substring(0,r[1]-1)+"…"),this.text=rt(e,t,n).filter((function(t){return""!==t})).join("\n")}this.callSuper.apply(this,["_set"].concat(r))}}),d.RssItem.fromObject=function(t,e){d.Object._fromObject("RssItem",t,e,"text")},d.WeatherItem=d.util.createClass(d.Text,{type:"weather-item",dims:gt,mtxt:null,smtl:{humidity:"Влажность: 100%",pressure:"Давление: 760 мм рт.ст.",wind:"Ветер: 15.7 м/с, северо-восточный",cond:"Облачно с прояснениями",temp:"32 °C"},initDimensions:Gt,_set:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(this.callSuper.apply(this,["_set"].concat(e)),"widget-weather"===(this.group||{}).type)switch(e[0]){case"charSpacing":case"fontFamily":case"fontWeight":case"fontSize":case"canvas":Gt.call(this)}}}),d.WeatherItem.fromObject=function(t,e){d.Object._fromObject("WeatherItem",t,e,"text")},d.Count=d.util.createClass(d.Text,{type:"count",prevent:!0,lockUniScaling:!1,lockScalingX:!1,lockScalingY:!1,textAlign:"center",originX:"center",originY:"center",toObject:function(){return this.callSuper("toObject",["interval","mark"])},_render:function(t){this.callSuper("_render",t),this.mark.visible&&(t.font=this.mark.font,this.mark.left||(this.mark.left=-t.measureText(this.mark.text).width/2),t.fillText(this.mark.text,this.mark.left,this.fontSize/2+10))}}),d.Count.prototype.initialize=function(t){return function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r;switch(t.call.apply(t,[this].concat(n)),g&&$t(this),n[1].interval){case"year":r="year";break;case"month":r="mon";break;case"day":r="day";break;case"hour":r="hr";break;case"minute":r="min"}this.set(vt({mark:{visible:!0,font:Wt(),left:null,text:r}}))}}(d.Count.prototype.initialize),d.Count.fromObject=function(t,e){d.Object._fromObject("Count",t,e,"text")},N(d.Object.prototype,{tl:{action:"scale",cursor:"nw-resize"},tr:{action:"scale",cursor:"ne-resize"},bl:{action:"remove",cursor:"pointer"},br:{action:"moveUp",cursor:"pointer"},mb:{action:"moveDown",cursor:"pointer"},mtr:{action:"rotate"}},{settings:{borderColor:"#0094dd",cornerBackgroundColor:"#0094dd",cornerShape:"circle",cornerPadding:7,cornerSize:20},mtr:{icon:A},tr:{icon:null},mb:{icon:z},br:{icon:U},bl:{icon:R}}),Object.entries({calendar:{},currency:{curr:"USD",rate:"RUB",short:!1},traffic:{clist:M},weather:{city:null},profile:{profile:"last-subscriber",userId:null,user:null},countdown:{tid:0},time:{tid:0},feed:{tid:0},json:{sid:""},info:{},rss:{channel:"https://news.yandex.ru/index.rss",charset:"utf-8",item:"random"}}).forEach((function(t){var e=Object(o.a)(t,2),n=e[0],u=e[1],b=["charSpacing","lineHeight","textAlign","fontFamily","fontSize","textFill"].concat("rss"===n?["visibleTitle","visibleContent","visibleDate","charsCount","textWidth"]:[]).concat("json"===n?["charsCount","textWidth"]:[]).concat("countdown"===n?["point","marks"]:[]).concat("profile"===n?["rounded"]:["icon"]).concat("traffic"===n?["code"]:[]).concat("weather"===n?["info"]:[]).concat("time"===n?["timezone"]:[]).concat("info"===n?["info"]:[]).concat("feed"===n?["feed"]:[]),m="Widget".concat(n[0].toUpperCase()).concat(n.slice(1)),v=b.reduce((function(t,e){var i="traffic"===n?M.slice():[],r=!0;switch(e){case"visibleTitle":case"visibleContent":case"visibleDate":case"marks":r=!0;break;case"charsCount":r=160;break;case"charSpacing":case"point":r=0;break;case"lineHeight":r=1;break;case"textAlign":r="left";break;case"textFill":r="rgba(0,0,0,1)";break;case"fontFamily":r="Archive";break;case"fontSize":r=32;break;case"textWidth":r=520;break;case"timezone":r=180;break;case"info":case"feed":r=[];break;case"code":r=i[0]}return p(p({},t),{},Object(a.a)({},e,r))}),{});if(d[m]=d.util.createClass(d.Group,p(p({type:"widget-".concat(n),subTargetCheck:!0,ungrouped:!1,target:null,rest:[],originX:"left",originY:"top",height:0,width:0,left:0,top:0},u),v)),d[m].prototype._ungroup=d[m].prototype._modify=d[m].prototype._check=kt,d[m].prototype.initialize=function(t){return function(e){var n=this,i=e.objects,r=Object(s.a)(e,l);if(this.stopFix=!0,this.on("removed",(function(){return n.tid&&clearTimeout(n.tid)})),this.on("added",(function(){g&&(n.canvas.on("draw:state",n.drawState),["redo","undo"].includes(r.stateAction)&&(n.canvas.stackManagerStop=!0),setTimeout((function(){n.canvas.stackManagerStop=!1,n.stopFix=!1}),200));var t=n.canvas.localeDateString;switch(n.type){case"widget-info":g&&n.setinfo();break;case"widget-feed":g&&n.looping();break;case"widget-time":n.timing();break;case"widget-json":n.setJson();break;case"widget-rss":n.initFeed();break;case"widget-calendar":n.toSet({text:At(t,n.locale)},"text");break;case"widget-weather":g&&n.setweather({},!!r.init);break;case"widget-countdown":n.counting();break;case"widget-currency":n.setcurrency();break;case"widget-traffic":n.settraffic()}})),t.call(this,i,p({},vt(r))),g){switch(this.type){case"widget-currency":this.initcurrency();break;case"widget-traffic":this.inittraffic()}this.on("mousedblclick",(function(t){return setTimeout(n._ungroup.bind(n,t))})),this._modify=this._modify.bind(this),this._check=this._check.bind(this),this._objects.forEach((function(t){t.on("mousedblclick",n._ungroup.bind(n,{subTargets:[t]})),$t(t),t.set(vt())})),N(this,{tr:{cursor:"pointer",action:function(){n.stopFix=!0,n.canvas.trigger("widget:settings",n),setTimeout((function(){n.stopFix=!1}),200)}}})}}}(d[m].prototype.initialize),d[m].prototype.drawState=function(t){var e=t.state;this.still=e},d[m].prototype.stackManager=function(t){this.canvas&&(this.canvas.stackManagerStop=!!t),this.stopFix=!!t},d[m].prototype.toObject=function(t){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.call(this,dt.concat(e))}}(d[m].prototype.toObject),d[m].prototype.initDimensions=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=Nt(this);this._objects.forEach((function(i){i.type===n&&(i.__skipDimension=e,i.initDimensions(t.info||[])),t.width<i.width&&(t.width=i.width),i.setCoords()})),e||this.setCoords(),d.request()},d[m].prototype.shake=function(){var t=this;return this.canvas?new Promise((function(e){t.target||t.rest.length||t._ungroup({subTargets:[t._objects[0]]}),setTimeout(e)})).then((function(){t._modify({suppress:!0})})).catch(kt):Promise.resolve()},d[m].prototype.requestRender=O((function(){!this.still&&this.canvas&&this.canvas.requestRenderAll()}),0),d[m].prototype.widgetUpdate=O((function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.resolve,i=e.shake,r=void 0===i||i,s=e.skip,o=void 0!==s&&s;if(this.stackManager(1),this.initDimensions(o),"function"!=typeof n&&(n=kt),r&&g)return this.shake().finally((function(){t.stackManager(0),n()}));this.stackManager(0),n()}),0),d[m].prototype.distort=function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];this.canvas&&(t=this.canvas).trigger.apply(t,["canvas:distort"].concat(n))},d[m].prototype.toSet=function(t,e){var n=this;return new Promise((function(i){if(n._objects.every((function(n){return e&&e!==n.type||n.set(t),!0})),!["redo","undo"].includes(n.stateAction))return n.widgetUpdate({resolve:i});i()}))},"profile"===n)d[m].prototype.rounding=function(){var t,e=this,n=this.rounded;return new Promise((function(i){if((t=e._objects.find((function(t){return"rect"===t.type})))&&(t.set({rx:n?t.height/2:0,ry:n?t.width/2:0}),!["redo","undo"].includes(e.stateAction)))return e.widgetUpdate({resolve:i});i()}))};else if("currency"===n)d[m].prototype.initcurrency=function(){Object.keys(yt).length||Et("currency").then((function(t){return yt=t})).catch(kt)},d[m].prototype.setcurrency=Object(c.a)(h.a.mark((function t(){var e,n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(g){t.next=2;break}return t.abrupt("return");case 2:if(!(n=this._objects.find((function(t){return"text"===t.type})))){t.next=9;break}return t.next=5,Tt();case 5:if(e=Ct(this.curr,this.rate),n.set({text:this.short?"".concat(this.curr," ").concat(e):"1 ".concat(this.curr," ").concat(e," ").concat(this.rate)}),["redo","undo"].includes(this.stateAction)){t.next=9;break}return t.abrupt("return",this.widgetUpdate({}));case 9:case"end":return t.stop()}}),t,this)})));else if("traffic"===n)d[m].prototype.inittraffic=function(){wt||Et("traffic").then((function(t){wt=t})).catch(kt)},d[m].prototype.settraffic=Object(c.a)(h.a.mark((function t(){var e,n,i,r,s,o=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(g){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,Dt();case 4:if(e=function(t){return t.code===o.code.geoid||t.code===o.code.code},n=(wt||[]).find(e)||{},i=n.icon,r=n.level,s=n.hint,i&&this._objects.find((function(t){return"circle"===t.type})).set({fill:i,color:i}),r&&s&&this._objects.find((function(t){return"text"===t.type})).set("text","".concat(s,"\n").concat(r)),["redo","undo"].includes(this.stateAction)){t.next=9;break}return t.abrupt("return",this.widgetUpdate({}));case 9:case"end":return t.stop()}}),t,this)})));else if("info"===n)d[m].prototype.setinfo=function(){var t,e,n=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise((function(r){if((e=n._objects.find((function(t){return"text"===t.type})))&&(t=n.canvas.$t||jt.bind(null,ft,n.locale||"ru"),e.set({text:n.info.map((function(e){return t("graph.".concat(e))+": ".concat(i[e]||lt[e])})).join("\n")}),!["redo","undo"].includes(n.stateAction)))return n.widgetUpdate({resolve:r});r()}))};else if("rss"===n)d[m].prototype.setVisibilityItem=Ht,d[m].prototype.randomEvent=function(){xt&&this.setFeed(xt[Math.floor(Math.random()*xt.length)])},d[m].prototype.initFeed=function(){var t=this;if(g&&this.channel)return(xt||[]).length?this.randomEvent():void Ut(this.channel,this.charset).then((function(e){var n,i=e.response;null!==(n=i.feed)&&void 0!==n&&n.length&&(xt=i.feed,t.randomEvent())})).catch(kt)},d[m].prototype.setFeed=function(t){(this.target||this.rest.length)&&this._modify({suppress:!0});var e,n=0;if(this._objects.some((function(i){return!!["title","content","date"].includes(i.label)&&(e=It(t[i.label]),i.set({text:e,originalString:e}),++n>2)})),!["redo","undo"].includes(this.stateAction))return this.widgetUpdate()},d[m].prototype.setCharsCount=function(t){(this.target||this.rest.length)&&this._modify({suppress:!0});var e=0;this._objects.some((function(n){return!!["title","content"].includes(n.label)&&(n.set({chars:t}),++e>1)}))};else if("json"===n)d[m].prototype.setJson=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,n=t.size,i=t.chars,r=t.text;(this.target||this.rest.length)&&this._modify({suppress:!0}),void 0===r&&(r=Y.get()),i||(i=this.charsCount),e||(e=this.textWidth),n||(n=this.fontSize);var s,o=this.getContext({fontSize:n});return o&&(s=this._objects.find((function(t){return"text"===t.type})))?(r=r.replace(/(\r\n|\n|\r|\s)+/gim," "),s.set({fontSize:n,width:e}),r.length>i&&(r=r.substring(0,i-1).trim()+"…"),r=rt(o,r,e).filter((function(t){return""!==t})).join("\n"),this.toSet({text:r},"text").then(this.distort.bind(this))):Promise.resolve()};else if(["countdown","time","feed"].includes(n))switch(d[m].prototype.next=function(t,e){this.tid&&clearTimeout(this.tid),this.tid=setTimeout(t,e),this.initDimensions(),this.dirty=!0},n){case"countdown":d[m].prototype.counting=function(){var t=this;!function e(){Kt.call(t),t.next(e,1e3*(60-(new Date).getSeconds()))}()},d[m].prototype.switchMarks=function(t){this._objects.forEach((function(e){"count"===e.type&&e.set("mark",p(p({},e.mark),{},{visible:t}))}))};break;case"time":d[m].prototype.timing=function(){var t=this._objects.find((function(t){return"text"===t.type})),e=this.canvas.localeDateString,n=this;!function i(){t.text=Rt(e,n.locale,n.timezone),n.next(i,1e3*(60-(new Date).getSeconds()))}()},d[m].prototype.setTimezone=function(t){this.timezone=t,this.timing()};break;case"feed":d[m].prototype.looping=g?function(){var t=this._objects.find((function(t){return"text"===t.type})),e=this,n=0;!function i(){n%=e.feed.length,e.feed=e.feed.filter((function(t){return"string"==typeof t})),t.text=e.feed[n++]||"",e.next(i,1e4)}()}:function(t){this._objects.find((function(t){return"text"===t.type})).set("text",this.feed[t]||"")}}else"weather"===n&&(d[m].prototype.find=Mt,d[m].prototype.setweather=function(){var t,e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise((function(r){if((t=e._objects.find((function(t){return"weather-item"===t.type})))&&(t.set({text:e.info.map((function(t){return"".concat(n[t]||ht[t])})).join("\n")}),i&&!["redo","undo"].includes(e.stateAction)))return e.widgetUpdate({resolve:r,skip:!0});r()}))});d[m].fromObject=function(t,e){var n=t.objects,i=Object(s.a)(t,f);i=d.util.object.clone(i,!0),d.util.enlivenObjects(n,(function(t){e(new d[m](p({objects:t},i)))}))},d[m].async=!0,g&&(d[m].prototype.onChangeFix=O((function(){!this.stopFix&&this.canvas?this.canvas.trigger("programmatic"):this.stopFix=!1}),0),d[m].prototype._check=function(t){var e=t.target;e===this.target||this.rest.find((function(t){return t===e}))||this._modify()},d[m].prototype._ungroup=function(t){var e=this,n=Object(o.a)(t.subTargets,1)[0];!this.ungrouped&&n&&this.canvas&&!this.target&&(this.ungrouped=this.canvas.stackManagerStop=!0,this.rest=this._objects.filter((function(t){return t!==n})),this.target=n,this.canvas.trigger("leave:events",[]),this.canvas.on("mouse:down",this._check),this.target.on("modified",this._modify),this.rest.forEach((function(t){t.on("modified",e._modify)})),this.initDimensions(),this.canvas.discardActiveObject(),this.removeWithUpdate(n),this.canvas.insertTo(n),this.rest.length&&(this.rest.forEach(this.removeWithUpdate,this),this.rest.forEach(this.canvas.insertTo,this.canvas)),this.canvas.setActiveObject(n))},d[m].prototype._modify=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.suppress,i=e.e,s=void 0===i?{}:i;if(this.target&&this.canvas){var o;if(this.canvas.off("mouse:down",this._check),this.target.off("modified",this._modify),this.rest.forEach((function(e){e.off("modified",t._modify)})),this.canvas.discardActiveObject(),this.canvas.remove(this.target),this.addWithUpdate(this.target),this.rest.length)(o=this.canvas).remove.apply(o,Object(r.a)(this.rest)),this.rest.forEach(this.addWithUpdate,this);this.initDimensions(),this.canvas.setActiveObject(this),this.ungrouped=this.canvas.stackManagerStop=!1,this.target=null,this.rest=[],this.canvas.trigger("restore:events",[]),n&&"mouseup"!==s.type||this.canvas.trigger("programmatic")}},d[m]=new Proxy(d[m],{construct:function(t,e){var n=Object(i.a)(t,Object(r.a)(e)),s=new Proxy(n,{set:function(t,e,n){switch(e){case"charSpacing":case"lineHeight":case"textAlign":case"fontFamily":case"fontSize":t.dirty=Reflect.set(t,e,n),t.toSet(Object(a.a)({},e,n),Nt(t)),"widget-json"===t.type&&t.setJson();break;case"textFill":t.dirty=Reflect.set(t,e,n),t.toSet({fill:n},["widget-traffic","widget-profile"].includes(t.type)?"text":null);break;case"textWidth":switch(t.dirty=Reflect.set(t,e,n),t.type){case"widget-rss":t.toSet({maxWidth:n},"rss-item");break;case"widget-json":t.setJson({width:n})}break;case"charsCount":switch(t.dirty=Reflect.set(t,e,n),t.type){case"widget-rss":t.setCharsCount(n);break;case"widget-json":t.setJson({chars:n})}break;case"channel":case"charset":t.dirty=Reflect.set(t,e,n),t.initFeed();break;case"visibleContent":case"visibleTitle":case"visibleDate":t.dirty=Reflect.set(t,e,n),t.setVisibilityItem(e,n);break;case"rounded":t.dirty=Reflect.set(t,e,n),t.rounding();break;case"marks":t.dirty=Reflect.set(t,e,n),t.switchMarks(n);break;case"icon":t.dirty=Reflect.set(t,e,n),t.toSet({visible:n},"widget-traffic"===t.type?"circle":"path");break;case"short":case"curr":case"rate":t.dirty=Reflect.set(t,e,n),t.setcurrency();break;case"code":t.dirty=Reflect.set(t,e,n),t.settraffic();break;case"info":switch(t.dirty=Reflect.set(t,e,n),t.type){case"widget-weather":t.setweather();break;case"widget-info":t.setinfo()}break;case"point":Kt.call(t,n),t.dirty=!0;break;default:Reflect.set(t,e,n)}return g&&e in v&&t.onChangeFix(),g&&d.request(),!0}});return s.originalTarget=n,s}}))})),d.Object.prototype.initialize=Yt(d.Object.prototype.initialize),d.Object.prototype.isOnScreen=Jt(d.Object.prototype.isOnScreen),d.Object.prototype.toObject=qt(d.Object.prototype.toObject),d.Object.prototype.customName=Xt(),d.Object.prototype.getContext=Bt(),d.Object.prototype.setUnique=Lt(),d.Triangle=H(d.Triangle,d),d.Ellipse=H(d.Ellipse,d),d.Line=H(d.Line,d),d.Rect=H(d.Rect,d),d=V(d),d=Q(d),d=tt(d),d=nt(d),e.abrupt("return",d);case 154:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}}.call(this,n(38))}}]);