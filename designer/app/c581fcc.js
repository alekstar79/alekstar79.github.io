(window.webpackJsonp=window.webpackJsonp||[]).push([[267],{1186:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(3),n(51),n(25);function r(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return new Promise((function(e){return setTimeout.apply(void 0,[e,t].concat(n))}))}},1215:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));n(32),n(29),n(52),n(16),n(62),n(66);var r=n(10),a=n(11);n(3),n(12),n(34),n(140),n(9),n(94),n(373),n(14),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(15),n(182),n(24),n(67);function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){c=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var s={A:65,b:66,C:67,D:68,E:69,F:70,g:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,r:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Pause:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Delete:46,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},c=function(){function t(e){Object(r.a)(this,t),this.keyCode=e}return Object(a.a)(t,[{key:"equals",value:function(t){var e=t.keyCode;return this.keyCode===e}}],[{key:"fromEvent",value:function(e){return new t(e.keyCode)}},{key:"fromString",value:function(e){var n=e.toUpperCase(),r=null;if(1===e.length)return new t(e.toUpperCase().charCodeAt(0));if(Object.keys(s).some((function(t){return(t===e||t===n)&&(r=s[e]||s[n],!0)})),r)return new t(r);throw new Error("Unknown key name: ".concat(e))}}]),t}(),u=function(){function t(e){var n=this;Object(r.a)(this,t);var a=e.split("+").map((function(t){return t.trim()}));if(this.shift=!1,this.ctrl=!1,this.meta=!1,this.alt=!1,t.fns.forEach((function(t){var e=a.indexOf(t);e>=0&&(a.splice(e,1),n[t]=!0)})),1!==a.length)throw new Error("Invalid keybind source: ".concat(e));this.key=c.fromString(a[0])}return Object(a.a)(t,[{key:"match",value:function(e){var n=this;return!t.fns.some((function(t){return n[t]!==e["".concat(t,"Key")]}))&&this.key.equals(c.fromEvent(e))}}]),t}();u.fns=["alt","shift","ctrl","meta"];var l=Object(a.a)((function t(e,n){Object(r.a)(this,t),this.combination=e,this.handler=n}));var f=function(){function t(){var e=this;Object(r.a)(this,t),["handler","untrack","track","unbind","bind","dispose"].forEach((function(t){e[t]=e[t].bind(e)})),this.keybinds=new Set,this.enable=!1}return Object(a.a)(t,[{key:"handler",value:function(t){if(!t.repeat){var e,n=o(this.keybinds);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.combination.match(t)){t.stopImmediatePropagation(),t.preventDefault(),r.handler(t);break}}}catch(a){n.e(a)}finally{n.f()}}}},{key:"on",value:function(t,e){var n=new l(new u(t),e);return this.keybinds.add(n),n}},{key:"bind",value:function(t){var e=this;return t.map((function(t){return e.on(t.keys,t.handler)}))}},{key:"unbind",value:function(t){var e=this;t.forEach((function(t){return e.keybinds.delete(t)}))}},{key:"dispose",value:function(){this.keybinds.clear()}},{key:"track",value:function(){var t,e;this.enable||(t=this.handler,window&&window.addEventListener("keydown",t,e),this.enable=!0)}},{key:"untrack",value:function(){var t,e;t=this.handler,window&&window.removeEventListener("keydown",t,e),this.enable=!1}}],[{key:"instance",get:function(){return t.self||(t.self=new t),t.self}}]),t}();f.self=null},1216:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(25);function r(t){var e,n=t.url,r=t.height,a=t.width,o=t.target,i=void 0===o?"auth":o,s=t.left,c=void 0===s?null:s,u=t.top,l=void 0===u?null:u;if(null===c||null===l){var f=window.outerHeight||document.body.clientHeight-22,p=window.outerWidth||document.body.clientWidth,d=window.screenX||window.screenLeft,h=window.screenY||window.screenTop;l=Math.round(h+(f-r)/2.5),c=Math.round(d+(p-a)/2)}return e="width=".concat(a,",height=").concat(r,",left=").concat(c,",top=").concat(l),window.open(n,i,e)}},1219:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return s}));n(16),n(26),n(27),n(13),n(2),n(182),n(161),n(19),n(3),n(52),n(14),n(25),n(75),n(24),n(53),n(12),n(34),n(9),n(373),n(374),n(375),n(376),n(377),n(378),n(379),n(380),n(381),n(382),n(383),n(384),n(385),n(386),n(387),n(388),n(389),n(15),n(43),n(57),n(1200),n(255),n(180),n(58);n(394);var r=n(1132),a=n.n(r);var o=function(t){return"    ".repeat(t)};o(1),o(2);var i=function(t){return a.a.send("VKWebAppShowCommunityWidgetPreviewBox",t)},s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Ошибка",e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{content:t,color:"error",raw:e}}},1236:function(t,e,n){"use strict";n.d(e,"a",(function(){return p}));n(77);var r=n(10),a=n(11),o=n(496),i=n(46),s=n(39),c=n(28),u=n(1137);n(3);function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(c.a)(t);if(e){var a=Object(c.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(s.a)(this,n)}}var f=function(){},p=function(t){Object(i.a)(n,t);var e=l(n);function n(){var t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;return Object(r.a)(this,n),(t=e.call(this,(function(e,n){a((function(r){var a;null!==(a=Object(o.a)(t))&&void 0!==a&&a.canceled?t.silent||n(new Error("Cancelled")):e(r)}),n)}))).canceled=!1,t}return Object(a.a)(n,[{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.silent=t,this.canceled=!0}}]),n}(Object(u.a)(Promise))},1407:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));n(77),n(2);var r=n(10),a=n(11),o=n(46),i=n(39),s=n(28),c=n(1137);n(1408),n(1444),n(0),n(3),n(51),n(1409),n(16),n(62);function u(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(s.a)(t);if(e){var a=Object(s.a)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Object(i.a)(this,n)}}Symbol.asyncIterator;function l(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=t.length-1,o=0,i=function i(){o<=a&&(e(t[o],o),n=setTimeout(i,r),o++)};return i(),function(){clearTimeout(n)}}},1473:function(t,e,n){"use strict";(function(t){n(16),n(26),n(27),n(52),n(62),n(66);var r=n(22),a=n(2),o=n(1),i=n(0),s=n.n(i),c=(n(685),n(3),n(14),n(1240),n(1307),n(15),n(9),n(25),n(34),n(19),n(43),n(57),n(24),n(53),n(67),n(29),n(740),n(101),n(32),n(12),n(183),n(4)),u=n(597),l=n(199),f=n(1708),p=n(457),d=n(255),h=n(234),v=n(1215),b=n(395),g=n(1445),m=n(1467),w=n(1140),k=n(1446),y=n.n(k);function x(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return O(t,e)}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function j(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?j(Object(n),!0).forEach((function(e){Object(a.a)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var $="Дизайнер - это онлайн-редактор изображений, использующий HTML5 Canvas.";e.a={layout:"graph",mixins:[m.d,m.a,m.b,w.d,m.c],head:function(){return{title:this.$t("common.designer"),meta:[{name:"description",hid:"description",content:$},{name:"og:description",hid:"og:description",content:$},{name:"og:url",hid:"og:url",content:"/designer"},{name:"twitter:card",hid:"twitter:card",content:"summary_large_image"},{name:"twitter:title",hid:"twitter:title",content:"Дизайн группы ВК | Дизайн ВК онлайн"},{name:"twitter:description",hid:"twitter:description",content:$},{name:"twitter:image",hid:"twitter:image",content:"/designer/icon.png"}]}},jsonld:function(){return{"@context":"https://schema.org/","@type":"WebSite",name:"Дизайнер",url:"/designer",image:"/designer/icon.png",sameAs:["http://vk.com/netaggregator"],description:$}},data:function(){var t=this.$store.state.canvas.fixed;return{file:{format:"png",qtOutput:1,quality:.6,name:"",size:0},visible:{bottom:t,right:!1,left:!1,top:t},size:{bottom:"90%",right:"90vh",left:"90vh",top:"50%"},maxWidth:this.mobile?"100%":"700px",printer:c.Printer.init(),bindings:v.a.instance,busHandlers:new WeakMap,edit_zone_reset:!1,buttons:[{icon:"quick_save"},{icon:"save"},{icon:"fit_window"},{icon:"layers"},{icon:"info"},{icon:"print"}],introViewed:!0,opencovers:!1,clipboard:!1,zoomrange:!1,loading:!1,evented:!1,dataurl:!1,openurl:!1,onover:!1,glitch:!1,cover:!1,video:!1,ready:!1,saved:!1,rembg:!1,videostream:null,rembgsource:null,b64data:null,b64fake:null,context:null,fabric:null,canvas:null,eraser:null,drawer:null,copier:null,brush:null,crop:null,clip:null,tid:null,components:[],clipdata:[],content:[],drawers:[],models:[],tools:[],rightbar:[],leftbar:[],menu:[]}},computed:{localeDateString:function(){return!!(this.$BROWSER||{}).LOCALE_DATE_STRING_SUPPORTED},dragAndDropCapable:function(){return!!(this.$BROWSER||{}).DRAG_AND_DROP_CAPABLE},mobile:function(){return!!(this.$BROWSER||{}).IS_MOBILE},color:function(){return this.$store.state.app.color},logos:function(){var t=[g.logo];return this.dragAndDropCapable&&!this.mobile&&t.push(g.drop),t},drawingMode:{get:function(){return this.drawer.drawingMode},set:function(t){this.drawer=this.drawers[t]}}},watch:{"$store.state.canvas.controls":"snapGuidesHandler","$store.state.canvas.index":"restoreActiveObjects","$store.state.app.window":"setClientRect","$store.state.app":"stateTools","$store.state.canvas.drawerOptions":{deep:!0,handler:function(t){this.brush&&this.brush.setOptions(t)}},presentation:function(t){document.documentElement.classList[t?"add":"remove"]("presentation","fixed"),this.$store.commit("app/set",{presentation:t})},openurl:function(t){t?this.bindings.untrack():this.bindings.track()},dataurl:function(t){t?this.bindings.untrack():this.bindings.track()},video:function(t){t||(this.videostream=null)},context:function(t){t||this.printer.clear()},scaled:function(t){t&&this.scaling(t)},ready:function(){this.$bus.$emit("loading:finish")},canvas:"stateTools"},methods:{snack:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=t,r=e,a=!1;if(Object(p.a)(t)&&"content"in t){n=t.content;var o=t.color;r=void 0===o?e:o,a=t.raw}this.$bus.$emit("snack",{content:n,color:r,raw:a})},setMaxWidth:function(t){this.maxWidth=this.mobile?"100%":t||"700px"},checkIntoOverview:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$ls.get("designer:intro",!1);case 3:t.introViewed=e.sent,e.next=8;break;case 6:e.prev=6,e.t0=e.catch(0);case 8:case"end":return e.stop()}}),e,null,[[0,6]])})))()},onHover:function(t){var e=t.position,n=t.state;this.visible[e]=n},onChange:function(t){var e=t.position,n=t.size;this.size[e]=n},stateTools:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$nextTick();case 2:t.rightbar.concat(t.leftbar).forEach((function(t){t.reload()})),t.menu.forEach((function(t){t.reload()})),t.menu=t.menu.map((function(e){return _(_({},e),{},{items:e.items.filter((function(e){return!(e.exclude&&t.mobile)}))})}));case 5:case"end":return e.stop()}}),e)})))()},getTools:function(t){var e=this;return this.$nextTick().then((function(){return e.rightbar.concat(e.leftbar).filter((function(e){return!t.includes(e.id)}))}))},enableTools:function(){var t=arguments,e=this;return Object(o.a)(s.a.mark((function n(){var r,a,o;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:[],n.prev=1,n.t0=x,n.next=5,e.getTools(r);case 5:n.t1=n.sent,a=(0,n.t0)(n.t1);try{for(a.s();!(o=a.n()).done;)o.value.lock=!1}catch(i){a.e(i)}finally{a.f()}return n.next=10,e.stateTools();case 10:n.next=14;break;case 12:n.prev=12,n.t2=n.catch(1);case 14:case"end":return n.stop()}}),n,null,[[1,12]])})))()},disableTools:function(){var t=arguments,e=this;return Object(o.a)(s.a.mark((function n(){var r,a,o;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:[],n.prev=1,n.t0=x,n.next=5,e.getTools(r);case 5:n.t1=n.sent,a=(0,n.t0)(n.t1);try{for(a.s();!(o=a.n()).done;)o.value.lock=!0}catch(i){a.e(i)}finally{a.f()}return n.next=10,e.stateTools();case 10:n.next=14;break;case 12:n.prev=12,n.t2=n.catch(1);case 14:case"end":return n.stop()}}),n,null,[[1,12]])})))()},snapGuidesHandler:function(t){var e=t.snap,n=t.save,r=t.open,a=t.grid;if(this.canvas){var o="graph-popup-snap-guides",i=this.tools.includes(o),s=this.canvas.showGrid,c=e||n||r;switch((a&&!s||!a&&s)&&this.canvas.toggleGrid(),!0){case!c&&i:this.tools=this.tools.filter((function(t){return t!==o}));break;case c&&!i:this.tools.push(o)}this.stateTools()}},isDynamicTool:function(){return this.canvas._objects.some((function(t){return t&&"dynamic-background"===t.type}))},setClientRect:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.fabric&&void 0!==t.$refs.container){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.setClient();case 4:["height","width","left","top"].forEach((function(e){t.$refs.container.style[e]=t.client[e]+"px"}));case 5:case"end":return e.stop()}}),e)})))()},setEvents:function(){this.$off("drawingtool:history",this.stateTools),this.$on("drawingtool:history",this.stateTools)},setTools:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$nextTick();case 2:t.fabric.toolbox.forEach((function(e){var n=e.id,r=e.init;return t[n]=r(t)})),t.canvas.showGrid=!1,t.canvas.createGrid(),t.drawers.length||(t.drawers=c.drawers.map((function(t,e){return new t(e)}))),t.drawer||(t.drawer=t.drawers[0]),t.brush.toolsInit(t),t.canvas.render.start();case 9:case"end":return e.stop()}}),e)})))()},postInit:function(){var t=this;if(this.zoomrange=this.mobile,this.canvas&&this.incertToCanvas){var e=this.canvas.getZoom(),n=this.incertToCanvas,r=n.height,a=n.width,o=this.canvas,i=o.height,s=o.width/e/a,c=i/e/r;this.incertToCanvas.objects.forEach((function(e){e.set({top:e.top*c}),e.top<0&&e.set({top:0}),e.set({left:e.left*s}),e.left<0&&e.set({left:0}),t.canvas.insertTo(e)}))}this.incertToCanvas=null,this.$emit("force:hide")},setCanvas:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){var r;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,e.discharge(1);case 3:return n.next=5,e.beforeInit();case 5:return n.next=7,e.createContext(t);case 7:return n.next=9,e.setClientRect();case 9:return n.next=11,e.onInit();case 11:return n.next=13,e.init();case 13:return n.next=15,e.setTools();case 15:return e.bindStateHandler(),n.next=18,e.stack("clear");case 18:return e.coverDetect(),e.setEvents(),e.postInit(),n.abrupt("return",!0);case 24:n.prev=24,n.t0=n.catch(0),r=n.t0.message,e.snack({content:r,color:"error",raw:!0});case 28:case"end":return n.stop()}}),n,null,[[0,24]])})))()},imgResolver:function(t){var e=this,n=t.src,r=t.adjust,a=void 0!==r&&r;if(this.closeModals(),!n)return Promise.resolve();var i=function(){return e.snack("graph.not_loaded","warning")},c=function(t){return Promise.resolve(t)};return(/^https?:\/\//.test(n)?this.$axios.$get("/corsoutwit",{params:{src:n},responseType:"blob"}):c({})).then((function(t){var r,l,p={target:{result:n}};return t instanceof Blob&&((l=t).type&&(e.file.format=l.type.replace("image/","")),l.size&&(e.file.size=l.size)),(l?Object(u.a)(l):c(p)).then(function(){var t=Object(o.a)(s.a.mark((function t(n){var o,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=n.target.result,c=void 0===o?"":o,(r=Object(f.a)(c).type)&&(e.file.format=r.replace("image/","")),t.next=4,/\.svg$/.test(c)?e.loadSvg(c,!0):e.loadImage(c,i,a);case 4:e.$bus.$emit("image:loaded");case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})).catch(i)},setSearchImage:function(t){var e=t.largeImageURL;return this.imgResolver({src:e})},pasteImage:function(t){var e=this,n=t.sources,r=void 0===n?[]:n,a=function(t){return e.snack({content:t.message,color:"error",raw:!0})},o=function(t){return t.then((function(t){return e.loadImage(t,a)}))};switch(!0){case!!r.length&&!this.copier.empty:this.clipdata=[{type:"sys_clipboard",apply:function(){return Promise.all(r.map(o)).then((function(){e.canvas.trigger("programmatic"),e.clipboard=!1}))}},{type:"app_clipboard",apply:function(){return e.copier.paste().then((function(){e.canvas.trigger("programmatic"),e.clipboard=!1})).catch(a)}}],this.clipboard=!0;break;case!this.copier.empty:this.copier.paste().then((function(){e.canvas.trigger("programmatic")})).catch(a);break;case!!r.length:Promise.all(r.map(o)).then((function(){e.canvas.trigger("programmatic")}))}},readFile:function(t,e){var n=this;return Object(o.a)(s.a.mark((function r(){var a;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.t0=e,r.next=4,Object(u.a)(t);case 4:if(r.t2=a=r.sent,r.t1=null===r.t2,r.t1){r.next=8;break}r.t1=void 0===a;case 8:if(!r.t1){r.next=12;break}r.t3=void 0,r.next=13;break;case 12:r.t3=a.target.result;case 13:return r.t4=r.t3,(0,r.t0)(r.t4),r.abrupt("return",!0);case 18:r.prev=18,r.t5=r.catch(0),n.snack("graph.upload_error","error");case 21:return r.abrupt("return",!1);case 22:case"end":return r.stop()}}),r,null,[[0,18]])})))()},load:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){var r,a,o,i;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=!1,t.type.match("image/.*")){n.next=4;break}return e.snack.error.format(),n.abrupt("return",i);case 4:if(!t.type.match("image/hei(f|c)")){n.next=23;break}return a=t.name.replace(/\.hei[fc]/,".png"),r="png",(o=new FormData).set("file",t),e.loading=!0,n.prev=10,t={},n.next=14,fetch("/node/heic",{method:"POST",body:o});case 14:return t=n.sent,n.next=17,t.blob();case 17:t=n.sent,n.next=23;break;case 20:n.prev=20,n.t0=n.catch(10),e.snack.error.load();case 23:if((r||t.type)&&(e.file.format=r||t.type.replace("image/",""),e.file.quality=Object(c.calcQuality)(t.size),e.file.name=a||t.name,e.file.size=t.size),!e.file.format){n.next=34;break}return n.prev=25,n.next=28,/svg/.test(e.file.format)?e.openSvg(t):e.readFile(t,(function(t){return e.imgResolver({src:t})}));case 28:i=!0,n.next=34;break;case 31:n.prev=31,n.t1=n.catch(25),e.snack.error.read();case 34:return e.loading=!1,n.abrupt("return",i);case 36:case"end":return n.stop()}}),n,null,[[10,20],[25,31]])})))()},startEdit:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=t,!n.t0){n.next=6;break}return n.next=5,e.setCanvas(t);case 5:n.t0=n.sent;case 6:if(!n.t0){n.next=9;break}return n.next=9,e.loadJson(t);case 9:n.next=14;break;case 11:n.prev=11,n.t1=n.catch(0),e.snack({content:n.t1.message,color:"error",raw:!0});case 14:case"end":return n.stop()}}),n,null,[[0,11]])})))()},quickLoad:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,t.$ls.get("image-editor-save",null);case 3:return e.t1=e.sent,e.next=6,e.t0.startEdit.call(e.t0,e.t1);case 6:case"end":return e.stop()}}),e)})))()},quickSave:function(e){var n=this;return new Promise((function(r){if(!n.canvas||n.tid||"clear"===e)return r();n.tid=t(Object(o.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n.canvas.forEachObject((function(t){return t.ungrouped&&t._modify({suppress:!0})})),n.canvas._objects.find((function(t){return t.ungrouped}))){t.next=6;break}return t.next=5,n.$ls.set("image-editor-save",_(_({},n.canvas.toDatalessJSON()),n.scaled));case 5:n.saved=!0;case 6:t.next=10;break;case 8:t.prev=8,t.t0=t.catch(0);case 10:return t.next=12,n.$nextTick();case 12:n.tid=null,r();case 14:case"end":return t.stop()}}),t,null,[[0,8]])}))))}))},toDataURL:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.format,r=void 0===n?"png":n,a=e.quality,o=void 0===a?1:a,i=e.widgets,s=void 0===i||i,u=e.blob,l=void 0!==u&&u;return o||(o=this.file.qtOutput),r||(r=this.file.format),new Promise((function(e,n){Object(c.queueMicrotask)((function(){try{if(!t.canvas)return e(l?t.$refs.canvas:g.empty);t.canvas.clone((function(n){var a=t.$BROWSER.IS_SAFARI?h.distort:function(){return Promise.resolve()};n.setDimensions(t.origin).setZoom(1),n.adjustObjects(),s||(n._objects=n._objects.filter((function(t){return!t.type.includes("widget")}))),/jpe?g/.test(r)&&(n.backgroundColor="#fff"),a(n).then((function(){return l?n.toCanvasElement():n.toDataURL({format:r,quality:o})})).then(e)}))}catch(a){n(a)}}))}))},save:function(){var t=arguments,e=this;return Object(o.a)(s.a.mark((function n(){var r,a,o,i,c,u,l,f,p;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.length>0&&void 0!==t[0]?t[0]:{},a=r.format,o=void 0===a?"png":a,i=r.quality,c=void 0===i?1:i,u=r.widgets,l=void 0===u||u,c||(c=e.file.qtOutput),o||(o=e.file.format),n.prev=3,n.next=6,e.toDataURL({format:o,quality:c,widgets:l,blob:!0});case 6:f=n.sent,p=function(t){return y()(t,Object(d.rndstring)()+"."+o)},f.toBlob(p,"image/".concat(o),c),n.next=14;break;case 11:n.prev=11,n.t0=n.catch(3),e.snack({content:n.t0.message,color:"error",raw:!0});case 14:case"end":return n.stop()}}),n,null,[[3,11]])})))()},saveAsDataURL:function(){var t=this;return Object(o.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.toDataURL();case 3:n=e.sent,t.b64fake=n.length/2>3e5?n.slice(0,15e4)+n.slice(n.length-15e4):n.slice(),t.b64data=n,t.dataurl=!0,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t.snack("graph.converting_error","error");case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))()},saveAsJson:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$nextTick();case 3:y()(new Blob([JSON.stringify(_(_({},t.canvas.toDatalessJSON()),t.scaled))],{type:"application/json;charset=utf-8"}),Object(d.rndstring)()+".json"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t.snack("graph.converting_error","error");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},saveAsUBJson:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$nextTick();case 3:y()(new Blob([Object(b.b)(_(_({},t.canvas.toDatalessJSON()),t.scaled))],{type:"application/octet-stream"}),Object(d.rndstring)()+".wxg"),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t.snack("graph.converting_error","error");case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},toolInset:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e||this.tools.includes(t)?this.tools=this.tools.filter((function(e){return e!==t})):this.tools.push(t),this.enableTools()},toolApply:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){var r,a,o,i,c;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.tool,a=t.payload,n.next=3,e.$nextTick();case 3:n.t0=r,n.next="pencil"===n.t0?6:"draw"===n.t0?19:"filter"===n.t0?21:"clipto"===n.t0?24:26;break;case 6:if(c=e.canvas.freeDrawingBrush,i=c&&"finalize"in c,o=c&&"apply"in c,!c||!a.on){n.next=17;break}n.t1=!0,n.next=n.t1===i?13:n.t1===o?15:17;break;case 13:return c.finalize(),n.abrupt("break",17);case 15:return c.apply(!1),n.abrupt("break",17);case 17:return Object.keys(a).forEach((function(t){"apply"===t?o&&c.apply(a[t]):e.brush[t]=a[t]})),n.abrupt("break",26);case 19:return e.$store.commit("canvas/setDrawerOption",{img:a}),n.abrupt("break",26);case 21:return n.next=23,e.filterApply({payload:a});case 23:return n.abrupt("break",26);case 24:return e.releaseClip(a),n.abrupt("break",26);case 26:case"end":return n.stop()}}),n)})))()},checkRunState:function(){var t=this;return Object(o.a)(s.a.mark((function e(){var n,r,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.$store.state,r=n.app.presentation,a=n.cover,t.closeModals(),e.t0=!0,e.next=e.t0===!!r?5:e.t0===!!a.edit?8:e.t0===!!a.image?13:17;break;case 5:return e.next=7,t.startIntro({presentation:r});case 7:return e.abrupt("break",17);case 8:return e.next=10,t.startEdit(a.edit);case 10:return t.hash=a.hash,t.tmpl=a.tmpl,e.abrupt("break",17);case 13:return e.next=15,t.imgResolver(a.image);case 15:return t.hash=null,e.abrupt("break",17);case 17:case"end":return e.stop()}}),e)})))()},dropHandler:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){var r,a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.dataTransfer,e.onover=!1,a=0;case 3:if(!(a<r.files.length)){n.next=11;break}return n.next=6,e.load(r.files[a]);case 6:if(!n.sent){n.next=8;break}return n.abrupt("break",11);case 8:a++,n.next=3;break;case 11:case"end":return n.stop()}}),n)})))()},dragleaveHandler:function(){this.onover=!1},dragenterHandler:function(){this.onover=!0},eventBusOn:function(){var t=this;Object.entries(g.busEvents).forEach((function(e){var n=Object(r.a)(e,2),a=n[0],o=n[1];t.busHandlers.has(t[o])||(t.busHandlers.set(t[o],a),t.$bus.$on(a,t[o]))}))},eventBusOff:function(){var t=this;Object.entries(g.busEvents).forEach((function(e){var n=Object(r.a)(e,2),a=n[0],o=n[1];t.busHandlers.delete(t[o]),t.$bus.$off(a,t[o])}))},forceUpdate:function(){this.edit_zone_reset=!this.edit_zone_reset,this.$forceUpdate(),Object(l.a)('[class*="canvas-text-renderer"]'),Object(l.a)()},closeModals:function(){this.opencovers=!1,this.dataurl=!1,this.openurl=!1,this.video=!1},drop:function(){var t=this;this.$store.commit("cover/set",{edit:null,image:null,hash:null,tmpl:null});var e={rightbar:[],leftbar:[],menu:[],copier:null,brush:null,hash:null,tmpl:null};Object.keys(e).forEach((function(n){t[n]=e[n]}))},discharge:function(t){var e=this;return Object(o.a)(s.a.mark((function n(){var r,a;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.$nextTick();case 2:return["components","content","active","tools","drawers"].forEach((function(t){return e[t]=[]})),e.$off("drawingtool:history",e.stateTools),e.bindings.unbind(e.offmap),null===(r=e.canvas)||void 0===r||null===(a=r.render)||void 0===a||a.stop(),e.unbindStateHandler(),e.unbindMoveTracker(),e.trackerEventsOff(),e.removeAllObjects(),n.next=12,e.stack("dispose");case 12:e.cropzone&&e.cropReset(),n.t0=!0,n.next=n.t0===!!(1&t)?16:n.t0===!!(2&t)?18:n.t0===!!(4&t)?21:22;break;case 16:return e.mobile||(e.tools=["graph-popup-manager","graph-popup-info"]),n.abrupt("break",22);case 18:return e.eventBusOff(),e.drop(),n.abrupt("break",22);case 21:return n.abrupt("break",22);case 22:e.freedraw=!1,e.cursorMode=1,e.canvas=null,e.forceUpdate();case 26:case"end":return n.stop()}}),n)})))()},beforeInit:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.copier=new c.Copier(t),t.rightbar=Object(c.rightbar)(t),t.leftbar=Object(c.leftbar)(t),t.menu=Object(c.menu)(t),e.next=6,t.$store.dispatch("app/settingsLoad");case 6:return t.glitch=!1,e.next=9,t.$ls.get("image-editor-save",!1);case 9:t.saved=!!e.sent,t.brush=new c.Brush(t),t.crop=new c.Crop(t),t.clip=new c.Clip(t);case 13:case"end":return e.stop()}}),e)})))()},onInit:function(){var t=this;return Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$nextTick();case 2:t.initializeShortCutEvents(),t.bindMoveTracker(),t.eventBusOn();case 5:case"end":return e.stop()}}),e)})))()}},beforeMount:function(){var t=this.snack=this.snack.bind(this);this.snack.error={compress:function(){return t({content:"Compress image error",color:"error",raw:!0})},format:function(){return t({content:"Invalid image format",color:"error",raw:!0})},read:function(){return t({content:"Read image error",color:"error",raw:!0})},load:function(){return t({content:"Load image error",color:"error",raw:!0})}},this.beforeInit()},mounted:function(){var t=this;c.Fabric.resolve().then((function(e){e.Canvas.prototype.localeDateString=t.localeDateString,e.Canvas.prototype.$t=t.$t.bind(t),t.passFabricInstanceToTrack(e),t.fabric=e})).then(this.onInit).then(this.checkRunState).then(this.checkIntoOverview).then((function(){return t.dragAndDropCapable&&g.draggableEvents.forEach((function(e){t.$refs.container.addEventListener(e,(function(n){n.stopPropagation(),n.preventDefault(),t["".concat(e,"Handler")]&&t["".concat(e,"Handler")](n)}),!1)}))})).catch((function(e){t.snack({content:e.message,color:"error",raw:!0})})).finally((function(){t.ready=!0}))},asyncData:function(t){return Object(o.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,e.next=3,n.dispatch("cover/templatesLoad");case 3:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.discharge(2)}}}).call(this,n(739).setImmediate)},1504:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(1447);var a=r.a.extend({methods:{genBadge:function(){var t=this.$vuetify.lang,e=this.$attrs["aria-label"]||t.t(this.label),n=this.setBackgroundColor(this.color,{staticClass:"v-badge__badge",style:this.styles,on:this.$listeners,attrs:{"aria-atomic":this.$attrs["aria-atomic"]||"true","aria-label":e,"aria-live":this.$attrs["aria-live"]||"polite",title:this.$attrs.title,role:this.$attrs.role||"status"},directives:[{name:"show",value:this.isActive}]}),r=this.$createElement("span",n,[this.genBadgeContent()]);return this.transition?this.$createElement("transition",{props:{name:this.transition,origin:this.origin,mode:this.mode}},[r]):r}}})},1554:function(t,e,n){},1708:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));n(24),n(53);function r(t){var e={type:null,data:null};return e.data=t.replace(/data:(image\/.+);base64,/,(function(t,n){return e.type=n,""})),e}},1709:function(t,e,n){"use strict";n(1554)},1992:function(t,e,n){"use strict";n.r(e);var r=n(1143),a=n(1221),o=n(1119),i=n(1098),s=n(1094),c=n(1050),u=n(1048),l=n(1125),f=n(1306),p=n(1214),d=n(1185),h=n(1473).a,v=(n(1709),n(250)),b=Object(v.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"image-editor",class:"theme--".concat(t.$vuetify.theme.dark?"dark":"light")},[e("helper-dynamic-logo",{attrs:{src:t.logos,delay:1e4,glitch:t.glitch,fill:"#cfcfcf",height:"150px",width:"150px"}}),t._v(" "),e("client-only",[e("graph-hover-zone",{attrs:{position:"top",size:t.size.top},on:{hover:t.onHover}}),t._v(" "),t.ready?e("graph-top-toolbar",{ref:"menu",attrs:{menu:t.menu,visible:t.visible.top},on:{change:t.onChange}}):t._e(),t._v(" "),e("div",{ref:"container",staticClass:"editzone",on:{click:function(e){return e.target!==e.currentTarget?null:t.discardActive.apply(null,arguments)}}},[t.mobile?t._e():e("core-context",{ref:"context",attrs:{buttons:t.buttons,"data-id":"canvas-context-menu"},on:{hover:t.contextOnHover,toggle:t.contextOnChange},model:{value:t.context,callback:function(e){t.context=e},expression:"context"}}),t._v(" "),e("graph-rulers-guides",{directives:[{name:"show",rawName:"v-show",value:t.origin,expression:"origin"}],key:t.edit_zone_reset,on:{context:function(e){t.context=e}}},[e("canvas",{ref:"canvas"}),t._v(" "),e("graph-upper-cover",{ref:"cover",attrs:{components:t.components,content:t.content,evented:t.evented}})],1)],1),t._v(" "),e("graph-hover-zone",{attrs:{position:"left",size:t.size.left},on:{hover:t.onHover}}),t._v(" "),t.ready?e("graph-left-toolbar",{attrs:{tools:t.leftbar,visible:t.visible.left},on:{change:t.onChange,hide:t.onHover}}):t._e(),t._v(" "),e("graph-hover-zone",{attrs:{position:"right",size:t.size.right},on:{hover:t.onHover}}),t._v(" "),t.ready?e("graph-right-toolbar",{attrs:{tools:t.rightbar,visible:t.visible.right},on:{image:t.setSearchImage,create:t.setCanvas,change:t.onChange,hide:t.onHover,upload:t.load}}):t._e(),t._v(" "),e("graph-hover-zone",{attrs:{position:"bottom",size:t.size.bottom},on:{hover:t.onHover}}),t._v(" "),t.ready?e("graph-sticker-list",{ref:"sticker",attrs:{visible:t.visible.bottom},on:{change:t.onChange,hide:t.onHover,choose:t.add}}):t._e()],1),t._v(" "),t.zoomrange&&t.scaled?e("graph-zoom-range"):t._e(),t._v(" "),t.mobile||t.introViewed?t._e():e("helper-intro-btn",{on:{viewed:function(e){t.introViewed=e},"show:intro":t.startIntro}}),t._v(" "),t._l(t.tools,(function(n){return[e(n,{key:n,tag:"component",attrs:{snap:10},on:{change:function(e){t.drawingMode=e},"tool:cancel":function(e){return t.toolInset(n,e)},"tool:apply":t.toolApply}})]})),t._v(" "),e(a.a,{attrs:{"content-class":"graph-dialog video","max-width":t.mobile?"100%":"540px",fullscreen:t.mobile,persistent:""},model:{value:t.video,callback:function(e){t.video=e},expression:"video"}},[e("graph-video-open",{attrs:{videostream:t.videostream},on:{close:function(e){t.video=!1},open:t.imgResolver}})],1),t._v(" "),e(a.a,{attrs:{"content-class":"graph-dialog openurl","max-width":t.mobile?"100%":"540px",fullscreen:t.mobile},model:{value:t.openurl,callback:function(e){t.openurl=e},expression:"openurl"}},[e("graph-url-open",{attrs:{flag:t.openurl},on:{close:function(e){t.openurl=!1},open:t.imgResolver}})],1),t._v(" "),e(a.a,{attrs:{"content-class":"graph-dialog opencovers","max-width":t.mobile?"100%":"700px",fullscreen:t.mobile},model:{value:t.opencovers,callback:function(e){t.opencovers=e},expression:"opencovers"}},[e("graph-covers-select",{on:{close:function(e){t.opencovers=!1}}})],1),t._v(" "),e(a.a,{attrs:{"content-class":"graph-dialog dataurl","max-width":t.mobile?"100%":"540px",fullscreen:t.mobile},model:{value:t.dataurl,callback:function(e){t.dataurl=e},expression:"dataurl"}},[e("graph-data-url",{attrs:{b64data:t.b64data,b64fake:t.b64fake},on:{close:function(e){t.dataurl=!1}}})],1),t._v(" "),e(a.a,{attrs:{"content-class":"graph-dialog","max-width":t.maxWidth,fullscreen:t.mobile},model:{value:t.rembg,callback:function(e){t.rembg=e},expression:"rembg"}},[e("graph-remove-bg",{attrs:{image:t.rembgsource},on:{maxWidth:t.setMaxWidth,loading:function(e){t.loading=e},close:function(e){t.rembg=!1}}})],1),t._v(" "),e(a.a,{attrs:{transition:"dialog-top-transition","content-class":"graph-dialog clipboard","max-width":"350px",fullscreen:t.mobile},model:{value:t.clipboard,callback:function(e){t.clipboard=e},expression:"clipboard"}},[e(r.a,{staticClass:"covers-dialog__card",class:{fullscreen:t.mobile},attrs:{elevation:"0"}},[t.mobile&&t.$store.state.app.vkapp?e(f.a,{attrs:{height:"26px",color:"transparent"}}):t._e(),t._v(" "),t.mobile?t._e():e(p.a,{attrs:{color:t.color,flat:"",dark:""}},[e(d.b,[t._v("CHOOSE CLIPBOARD")])],1),t._v(" "),e(o.a,[t.mobile?e(l.a,[t._v("CHOOSE CLIPBOARD")]):t._e(),t._v(" "),t._l(t.clipdata,(function(n,r){return[e(i.a,{key:r,on:{click:n.apply}},[e(s.a,[e(s.b,[t._v("\n                "+t._s(t.$t("graph.".concat(n.type)))+"\n              ")])],1)],1)]}))],2)],1)],1),t._v(" "),e(c.a,{attrs:{value:t.loading,opacity:"0.5","z-index":"999",color:"rgba(75,75,75,.8)"}},[e(u.a,{attrs:{indeterminate:"",size:"64",color:t.color}})],1),t._v(" "),e("graph-paste-image",{on:{paste:t.pasteImage},scopedSlots:t._u([{key:"default",fn:function(){},proxy:!0}])})],2)}),[],!1,null,"4d17b098",null);e.default=b.exports;installComponents(b,{HelperDynamicLogo:n(1668).default,GraphHoverZone:n(1669).default,GraphTopToolbar:n(1670).default,CoreContext:n(1671).default,GraphUpperCover:n(1672).default,GraphRulersGuides:n(1673).default,GraphLeftToolbar:n(1674).default,GraphRightToolbar:n(1675).default,GraphStickerList:n(1676).default,GraphZoomRange:n(1677).default,HelperIntroBtn:n(1678).default,GraphVideoOpen:n(1679).default,GraphUrlOpen:n(1680).default,GraphCoversSelect:n(1681).default,GraphDataUrl:n(1682).default,GraphRemoveBg:n(1683).default,GraphPasteImage:n(1700).default})}}]);